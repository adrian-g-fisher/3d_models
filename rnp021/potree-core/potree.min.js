'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(e){var g=0;return function(){return g<e.length?{done:!1,value:e[g++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.makeIterator=function(e){var g='undefined'!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return g?g.call(e):$jscomp.arrayIterator(e)};
$jscomp.getGlobal=function(e){return'undefined'!=typeof window&&window===e?e:'undefined'!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||'function'==typeof Object.defineProperties?Object.defineProperty:function(e,g,t){e!=Array.prototype&&e!=Object.prototype&&(e[g]=t.value)};
$jscomp.polyfill=function(e,g,t,y){if(g){t=$jscomp.global;e=e.split('.');for(y=0;y<e.length-1;y++){var z=e[y];z in t||(t[z]={});t=t[z]}e=e[e.length-1];y=t[e];g=g(y);g!=y&&null!=g&&$jscomp.defineProperty(t,e,{configurable:!0,writable:!0,value:g})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,'description',{configurable:!0,writable:!0,value:g})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function e(t){if(this instanceof e)throw new TypeError('Symbol is not a constructor');return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(t||'')+'_'+g++,t)}var g=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('Symbol.iterator'));'function'!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol('Symbol.asyncIterator'));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.underscoreProtoCanBeSet=function(){var e={a:!0},g={};try{return g.__proto__=e,g.a}catch(t){}return!1};
$jscomp.setPrototypeOf='function'==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,g){e.__proto__=g;if(e.__proto__!==g)throw new TypeError(e+' is not extensible');return e}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError('Iterator result '+e+' is not an object');};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError('Generator is already running');this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(e){this.yieldResult=e};$jscomp.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(e,g){this.nextAddress=g;return{value:e}};$jscomp.generator.Context.prototype.yieldAll=function(e,g){e=$jscomp.makeIterator(e);var t=e.next();$jscomp.generator.ensureIteratorResultIsObject_(t);if(t.done)this.yieldResult=t.value,this.nextAddress=g;else return this.yieldAllIterator_=e,this.yield(t.value,g)};
$jscomp.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(e,g){this.catchAddress_=e;void 0!=g&&(this.finallyAddress_=g)};$jscomp.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0;this.finallyAddress_=e||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(e,g){this.nextAddress=e;this.catchAddress_=g||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(e){this.catchAddress_=e||0;e=this.abruptCompletion_.exception;this.abruptCompletion_=null;return e};$jscomp.generator.Context.prototype.enterFinallyBlock=function(e,g,t){t?this.finallyContexts_[t]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=e||0;this.finallyAddress_=g||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(e,g){g=this.finallyContexts_.splice(g||0)[0];if(g=this.abruptCompletion_=this.abruptCompletion_||g){if(g.isException)return this.jumpToErrorHandler_();void 0!=g.jumpTo&&this.finallyAddress_<g.jumpTo?(this.nextAddress=g.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e};$jscomp.generator.Context.prototype.forIn=function(e){return new $jscomp.generator.Context.PropertyIterator(e)};
$jscomp.generator.Context.PropertyIterator=function(e){this.object_=e;this.properties_=[];for(var g in e)this.properties_.push(g);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null};$jscomp.generator.Engine_=function(e){this.context_=new $jscomp.generator.Context;this.program_=e};
$jscomp.generator.Engine_.prototype.next_=function(e){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_);this.context_.next_(e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(e){this.context_.start_();var g=this.context_.yieldAllIterator_;if(g)return this.yieldAllStep_('return'in g?g['return']:function(e){return{value:e,done:!0}},e,this.context_.return);this.context_.return(e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(e){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_['throw'],e,this.context_.next_);this.context_.throw_(e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(e,g,t){try{var y=e.call(this.context_.yieldAllIterator_,g);$jscomp.generator.ensureIteratorResultIsObject_(y);if(!y.done)return this.context_.stop_(),y;var z=y.value}catch(E){return this.context_.yieldAllIterator_=null,this.context_.throw_(E),this.nextStep_()}this.context_.yieldAllIterator_=null;t.call(this.context_,z);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(g){this.context_.yieldResult=void 0,this.context_.throw_(g)}this.context_.stop_();if(this.context_.abruptCompletion_){e=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(e){this.next=function(g){return e.next_(g)};this.throw=function(g){return e.throw_(g)};this.return=function(g){return e.return_(g)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(e,g){g=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(g));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(g,e.prototype);return g};
$jscomp.asyncExecutePromiseGenerator=function(e){function g(g){return e.next(g)}function t(g){return e.throw(g)}return new Promise(function(y,z){function E(e){e.done?y(e.value):Promise.resolve(e.value).then(g,t).then(E,z)}E(e.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(e){return $jscomp.asyncExecutePromiseGenerator(e())};$jscomp.asyncExecutePromiseGeneratorProgram=function(e){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(e)))};
$jscomp.polyfill('Array.prototype.includes',function(e){return e?e:function(e,t){var g=this;g instanceof String&&(g=String(g));var z=g.length;t=t||0;for(0>t&&(t=Math.max(t+z,0));t<z;t++){var E=g[t];if(E===e||Object.is(E,e))return!0}return!1}},'es7','es3');
(function(e,g){'object'===typeof exports&&'undefined'!==typeof module?g(exports):'function'===typeof define&&define.amd?define(['exports'],g):(e=e||self,g(e.Potree={}))})(this,function(e){function g(a,b,c){this.name=a;this.type=b;this.numElements=c;this.byteSize=this.numElements*this.type.size}function t(a){this.attributes=[];this.size=this.byteSize=0;if(null!=a)for(var b=0;b<a.length;b++){var c=g[a[b]];this.attributes.push(c);this.byteSize+=c.byteSize;this.size++}}function y(a,b,c,f,d){this.id=y.IDCount++;
this.name=a;this.index=parseInt(a.charAt(a.length-1));this.pcoGeometry=b;this.geometry=null;this.boundingBox=c;this.boundingSphere=c.getBoundingSphere(new THREE.Sphere);this.scale=f;this.offset=d;this.children={};this.numPoints=0;this.level=null;this.loaded=!1;this.oneTimeDisposeHandlers=[];this.baseLoaded=!1;a=new THREE.Vector3;b=this.boundingBox.clone();b.min.sub(this.pcoGeometry.boundingBox.getCenter(a));b.max.sub(this.pcoGeometry.boundingBox.getCenter(a));this.scale&&(b.min.multiplyScalar(1/this.scale),
b.max.multiplyScalar(1/this.scale));this.greyhoundBounds=b;this.greyhoundOffset=this.pcoGeometry.offset.clone().add(this.pcoGeometry.boundingBox.getSize(new THREE.Vector3).multiplyScalar(.5))}function z(a){this.version=a;var b=-1===a.indexOf('.')?a.length:a.indexOf('.');this.versionMajor=parseInt(a.substr(0,b));this.versionMinor=parseInt(a.substr(b+1));0===this.versionMinor.length&&(this.versionMinor=0)}function E(){}function I(a,b,c,f){f=void 0===f||0===f?1:f;a=a.slice(c,c+b.BYTES_PER_ELEMENT*f);
b=new b(a);if(void 0===f||1===f)return b[0];a=[];for(c=0;c<f;c++)a.push(b[c]);return a}function Q(a){this.arraybuffer=a}function T(a){var b=this;this.arraybuffer=a;this.nextCB=null;this.dorr=function(a,f){b.nextCB=f;w.workerPool.runTask(A.LAS_LAZ,function(a){null!==b.nextCB&&(b.nextCB(a.data),b.nextCB=null)},a)}}function J(a){this.arraybuffer=a;this.determineVersion();if(12<this.version)throw Error('Only file versions <= 1.2 are supported at this time');this.determineFormat();if(void 0===ja[this.formatId])throw Error('The point format ID is not supported');
this.loader=this.isCompressed?new T(this.arraybuffer):new Q(this.arraybuffer)}function ca(a,b,c,f,d,l,k,v){this.arrayb=a;this.decoder=ja[b];this.pointsCount=f;this.pointSize=c;this.scale=d;this.offset=l;this.mins=k;this.maxs=v}function da(a){this.content=[];this.scoreFunction=a}function ka(a,b,c){var f=0,d=new Map(a.map(a=>[a,0])),l=[],k=[],v=Infinity,h=la(a,b),m=h.frustums,n=h.camObjPositions;h=h.priorityQueue;var e=0;c=c.domElement.clientHeight;w.pointcloudTransformVersion||(w.pointcloudTransformVersion=
new Map);for(var p=w.pointcloudTransformVersion,r=0;r<a.length;r++){var g=a[r];if(g.visible)if(g.updateMatrixWorld(),p.has(g)){var G=p.get(g);G.transform.equals(g.matrixWorld)||(G.number++,G.transform.copy(g.matrixWorld),g.dispatchEvent({type:'transformation_changed',target:g}))}else p.set(g,{number:0,transform:g.matrixWorld.clone()})}for(;0<h.size();){G=h.pop();var x=G.node;r=G.parent;g=a[G.pointcloud];var t=x.getBoundingBox(),y=n[G.pointcloud],u=m[G.pointcloud].intersectsBox(t);t=g.maxLevel||Infinity;
var z=x.getLevel();u=(u=u&&!(d.get(g)+x.getNumPoints()>g.pointBudget))&&z<t;x.spacing?v=Math.min(v,x.spacing):x.geometryNode&&x.geometryNode.spacing&&(v=Math.min(v,x.geometryNode.spacing));if(u)for(f+=x.getNumPoints(),t=d.get(g),d.set(g,t+x.getNumPoints()),g.numVisibleNodes++,g.numVisiblePoints+=x.getNumPoints(),!x.isGeometryNode()||r&&!r.isTreeNode()||(x.isLoaded()&&e<w.maxNodesLoadGPUFrame?(x=g.toTreeNode(x,r),e++):k.push(x)),x.isTreeNode()&&(w.lru.touch(x.geometryNode),x.sceneNode.visible=!0,x.sceneNode.material=
g.material,l.push(x),g.visibleNodes.push(x),void 0===x._transformVersion&&(x._transformVersion=-1),r=p.get(g),x._transformVersion!==r.number&&(x.sceneNode.updateMatrix(),x.sceneNode.matrixWorld.multiplyMatrices(g.matrixWorld,x.sceneNode.matrix),x._transformVersion=r.number),g.showBoundingBox&&!x.boundingBoxNode&&x.getBoundingBox?(r=new THREE.Box3Helper(x.getBoundingBox()),r.matrixAutoUpdate=!1,g.boundingBoxNodes.push(r),x.boundingBoxNode=r,x.boundingBoxNode.matrix.copy(g.matrixWorld)):g.showBoundingBox?
(x.boundingBoxNode.visible=!0,x.boundingBoxNode.matrix.copy(g.matrixWorld)):!g.showBoundingBox&&x.boundingBoxNode&&(x.boundingBoxNode.visible=!1)),t=x.getChildren(),r=0;r<t.length;r++){z=t[r];var A=0;if(b.isPerspectiveCamera){var D=z.getBoundingSphere(new THREE.Sphere);u=D.center.distanceTo(y);D=D.radius;A=.5*c/(Math.tan(b.fov*Math.PI/180/2)*u)*D;if(A<g.minimumNodePixelSize)continue;0>u-D&&(A=Number.MAX_VALUE)}else D=z.getBoundingBox(),u=z.getBoundingSphere(new THREE.Sphere).center.distanceTo(y),
A=D.max.clone().sub(D.min).length()/u;h.push({pointcloud:G.pointcloud,node:z,parent:x,weight:A})}}a=a.filter(a=>a.generateDEM&&a.dem instanceof DEM);for(g of a)a=g.visibleNodes.filter(a=>a.getLevel()<=w.maxDEMLevel),g.dem.update(a);for(r=0;r<Math.min(w.maxNodesLoading,k.length);r++)k[r].load();return{visibleNodes:l,numVisiblePoints:f,lowestSpacing:v}}function ma(a,b,c){for(var f=ka(a,b,c),d=0;d<a.length;d++)a[d].updateMaterial(a[d].material,a[d].visibleNodes,b,c),a[d].updateVisibleBounds();w.lru.freeMemory();
return f}function la(a,b,c){c=[];for(var f=[],d=new da(function(a){return 1/a.weight}),l=0;l<a.length;l++){var k=a[l];if(k.initialized()){k.numVisibleNodes=0;k.numVisiblePoints=0;k.deepestVisibleLevel=0;k.visibleNodes=[];k.visibleGeometry=[];b.updateMatrixWorld();var v=new THREE.Frustum,h=b.matrixWorldInverse,m=k.matrixWorld,n=b.clone();n.near=b.near;n.updateProjectionMatrix();n=b.projectionMatrix;h=(new THREE.Matrix4).multiply(n).multiply(h).multiply(m);v.setFromMatrix(h);c.push(v);v=b.matrixWorld;
m=(new THREE.Matrix4).getInverse(m);m=(new THREE.Matrix4).multiply(m).multiply(v);m=(new THREE.Vector3).setFromMatrixPosition(m);f.push(m);k.visible&&null!==k.root&&d.push({pointcloud:l,node:k.root,weight:Number.MAX_VALUE});k.root.isTreeNode()&&k.hideDescendants(k.root.sceneNode);for(m=0;m<k.boundingBoxNodes.length;m++)k.boundingBoxNodes[m].visible=!1}}return{frustums:c,camObjPositions:f,priorityQueue:d}}function K(a,b){if(b===THREE.RepeatWrapping)return a.REPEAT;if(b===THREE.ClampToEdgeWrapping)return a.CLAMP_TO_EDGE;
if(b===THREE.MirroredRepeatWrapping)return a.MIRRORED_REPEAT;if(b===THREE.NearestFilter)return a.NEAREST;if(b===THREE.NearestMipMapNearestFilter)return a.NEAREST_MIPMAP_NEAREST;if(b===THREE.NearestMipMapLinearFilter)return a.NEAREST_MIPMAP_LINEAR;if(b===THREE.LinearFilter)return a.LINEAR;if(b===THREE.LinearMipMapNearestFilter)return a.LINEAR_MIPMAP_NEAREST;if(b===THREE.LinearMipMapLinearFilter)return a.LINEAR_MIPMAP_LINEAR;if(b===THREE.UnsignedByteType)return a.UNSIGNED_BYTE;if(b===THREE.UnsignedShort4444Type)return a.UNSIGNED_SHORT_4_4_4_4;
if(b===THREE.UnsignedShort5551Type)return a.UNSIGNED_SHORT_5_5_5_1;if(b===THREE.UnsignedShort565Type)return a.UNSIGNED_SHORT_5_6_5;if(b===THREE.ByteType)return a.BYTE;if(b===THREE.ShortType)return a.SHORT;if(b===THREE.UnsignedShortType)return a.UNSIGNED_SHORT;if(b===THREE.IntType)return a.INT;if(b===THREE.UnsignedIntType)return a.UNSIGNED_INT;if(b===THREE.FloatType)return a.FLOAT;if(b===THREE.HalfFloatType){var c=extensions.get('OES_texture_half_float');if(null!==c)return c.HALF_FLOAT_OES}if(b===
THREE.AlphaFormat)return a.ALPHA;if(b===THREE.RGBFormat)return a.RGB;if(b===THREE.RGBAFormat)return a.RGBA;if(b===THREE.LuminanceFormat)return a.LUMINANCE;if(b===THREE.LuminanceAlphaFormat)return a.LUMINANCE_ALPHA;if(b===THREE.DepthFormat)return a.DEPTH_COMPONENT;if(b===THREE.DepthStencilFormat)return a.DEPTH_STENCIL;if(b===THREE.AddEquation)return a.FUNC_ADD;if(b===THREE.SubtractEquation)return a.FUNC_SUBTRACT;if(b===THREE.ReverseSubtractEquation)return a.FUNC_REVERSE_SUBTRACT;if(b===THREE.ZeroFactor)return a.ZERO;
if(b===THREE.OneFactor)return a.ONE;if(b===THREE.SrcColorFactor)return a.SRC_COLOR;if(b===THREE.OneMinusSrcColorFactor)return a.ONE_MINUS_SRC_COLOR;if(b===THREE.SrcAlphaFactor)return a.SRC_ALPHA;if(b===THREE.OneMinusSrcAlphaFactor)return a.ONE_MINUS_SRC_ALPHA;if(b===THREE.DstAlphaFactor)return a.DST_ALPHA;if(b===THREE.OneMinusDstAlphaFactor)return a.ONE_MINUS_DST_ALPHA;if(b===THREE.DstColorFactor)return a.DST_COLOR;if(b===THREE.OneMinusDstColorFactor)return a.ONE_MINUS_DST_COLOR;if(b===THREE.SrcAlphaSaturateFactor)return a.SRC_ALPHA_SATURATE;
if(b===THREE.RGB_S3TC_DXT1_Format||b===RGBA_S3TC_DXT1_Format||b===THREE.RGBA_S3TC_DXT3_Format||b===RGBA_S3TC_DXT5_Format)if(c=extensions.get('WEBGL_compressed_texture_s3tc'),null!==c){if(b===THREE.RGB_S3TC_DXT1_Format)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(b===THREE.RGBA_S3TC_DXT1_Format)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(b===THREE.RGBA_S3TC_DXT3_Format)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(b===THREE.RGBA_S3TC_DXT5_Format)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(b===THREE.RGB_PVRTC_4BPPV1_Format||
b===THREE.RGB_PVRTC_2BPPV1_Format||b===THREE.RGBA_PVRTC_4BPPV1_Format||b===THREE.RGBA_PVRTC_2BPPV1_Format)if(c=extensions.get('WEBGL_compressed_texture_pvrtc'),null!==c){if(b===THREE.RGB_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(b===THREE.RGB_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(b===THREE.RGBA_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(b===THREE.RGBA_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(b===THREE.RGB_ETC1_Format&&
(c=extensions.get('WEBGL_compressed_texture_etc1'),null!==c))return c.COMPRESSED_RGB_ETC1_WEBGL;if(b===THREE.MinEquation||b===THREE.MaxEquation)if(c=extensions.get('EXT_blend_minmax'),null!==c){if(b===THREE.MinEquation)return c.MIN_EXT;if(b===THREE.MaxEquation)return c.MAX_EXT}return b===UnsignedInt248Type&&(c=extensions.get('WEBGL_depth_texture'),null!==c)?c.UNSIGNED_INT_24_8_WEBGL:0}class Ja{constructor(a){this.next=this.previous=null;this.node=a}}class na{constructor(){this.last=this.first=null;
this.items={};this.numPoints=this.elements=0}size(){return this.elements}contains(a){return null==this.items[a.id]}touch(a){if(a.loaded)if(null==this.items[a.id]){var b=new Ja(a);b.previous=this.last;this.last=b;null!==b.previous&&(b.previous.next=b);this.items[a.id]=b;this.elements++;null===this.first&&(this.first=b);this.numPoints+=a.numPoints}else b=this.items[a.id],null===b.previous?null!==b.next&&(this.first=b.next,this.first.previous=null,b.previous=this.last,b.next=null,this.last=b,b.previous.next=
b):null!==b.next&&(b.previous.next=b.next,b.next.previous=b.previous,b.previous=this.last,b.next=null,this.last=b,b.previous.next=b)}remove(a){var b=this.items[a.id];b&&(1===this.elements?this.last=this.first=null:(b.previous||(this.first=b.next,this.first.previous=null),b.next||(this.last=b.previous,this.last.next=null),b.previous&&b.next&&(b.previous.next=b.next,b.next.previous=b.previous)),delete this.items[a.id],this.elements--,this.numPoints-=a.numPoints)}getLRUItem(){return null===this.first?
null:this.first.node}toString(){for(var a='{ ',b=this.first;null!==b;)a+=b.node.id,null!==b.next&&(a+=', '),b=b.next;return a=a+'}'+('('+this.size()+')')}freeMemory(){if(!(1>=this.elements))for(;this.numPoints>w.pointLoadLimit;)this.disposeDescendants(this.first.node)}disposeDescendants(a){var b=[];for(b.push(a);0<b.length;){a=b.pop();a.dispose();this.remove(a);for(var c in a.children)a.children.hasOwnProperty(c)&&a.children[c].loaded&&b.push(a.children[c])}}}class A{constructor(){this.workers=[];
for(var a=0;a<A.URLS.length;a++)this.workers.push([])}getWorker(a){return 0<this.workers[a].length?this.workers[a].pop():new Worker(w.workerPath+A.URLS[a])}returnWorker(a,b){this.workers[a].push(b)}runTask(a,b,c,f){var d=this,l=this.getWorker(a);l.onmessage=function(c){b(c);d.returnWorker(a,l)};void 0!==f?l.postMessage(c,f):l.postMessage(c)}}A.BINARY_DECODER=0;A.LAS_LAZ=1;A.LAS_DECODER=2;A.GREYHOUND=3;A.DEM=4;A.EPT_LAS_ZIP_DECODER=5;A.EPT_BINARY_DECODER=6;A.URLS='/workers/BinaryDecoderWorker.js /workers/LASLAZWorker.js /workers/LASDecoderWorker.js /workers/GreyhoundBinaryDecoderWorker.js /workers/DEMWorker.js /workers/EptLaszipDecoderWorker.js /workers/EptBinaryDecoderWorker.js'.split(' ');
var w={debug:{},workerPath:function(){if(document.currentScript&&document.currentScript.src){var a=(new URL(document.currentScript.src+'/..')).href;'/'===a.slice(-1)&&(a=a.slice(0,-1));return a}'undefined'!==typeof Q3D&&void 0!==Q3D.Config.potreeBasePath||console.error('Potree: Was unable to find its script path using document.currentScript.');return''}(),maxNodesLoadGPUFrame:20,maxDEMLevel:0,maxNodesLoading:void 0!==navigator.hardwareConcurrency?navigator.hardwareConcurrency:4,pointLoadLimit:1E10,
numNodesLoading:0,measureTimings:!1,workerPool:new A,lru:new na,pointcloudTransformVersion:void 0},u={POSITION_CARTESIAN:0,COLOR_PACKED:1,COLOR_FLOATS_1:2,COLOR_FLOATS_255:3,NORMAL_FLOATS:4,FILLER:5,INTENSITY:6,CLASSIFICATION:7,NORMAL_SPHEREMAPPED:8,NORMAL_OCT16:9,NORMAL:10,RETURN_NUMBER:11,NUMBER_OF_RETURNS:12,SOURCE_ID:13,INDICES:14,SPACING:15},C={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,
size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}},oa=0,pa;for(pa in C)C[oa]=C[pa],oa++;g.POSITION_CARTESIAN=new g(u.POSITION_CARTESIAN,C.DATA_TYPE_FLOAT,3);g.RGBA_PACKED=new g(u.COLOR_PACKED,C.DATA_TYPE_INT8,4);g.COLOR_PACKED=g.RGBA_PACKED;g.RGB_PACKED=new g(u.COLOR_PACKED,C.DATA_TYPE_INT8,3);g.NORMAL_FLOATS=new g(u.NORMAL_FLOATS,C.DATA_TYPE_FLOAT,3);g.FILLER_1B=
new g(u.FILLER,C.DATA_TYPE_UINT8,1);g.INTENSITY=new g(u.INTENSITY,C.DATA_TYPE_UINT16,1);g.CLASSIFICATION=new g(u.CLASSIFICATION,C.DATA_TYPE_UINT8,1);g.NORMAL_SPHEREMAPPED=new g(u.NORMAL_SPHEREMAPPED,C.DATA_TYPE_UINT8,2);g.NORMAL_OCT16=new g(u.NORMAL_OCT16,C.DATA_TYPE_UINT8,2);g.NORMAL=new g(u.NORMAL,C.DATA_TYPE_FLOAT,3);g.RETURN_NUMBER=new g(u.RETURN_NUMBER,C.DATA_TYPE_UINT8,1);g.NUMBER_OF_RETURNS=new g(u.NUMBER_OF_RETURNS,C.DATA_TYPE_UINT8,1);g.SOURCE_ID=new g(u.SOURCE_ID,C.DATA_TYPE_UINT8,1);g.INDICES=
new g(u.INDICES,C.DATA_TYPE_UINT32,1);g.SPACING=new g(u.SPACING,C.DATA_TYPE_FLOAT,1);t.prototype.add=function(a){this.attributes.push(a);this.byteSize+=a.byteSize;this.size++};t.prototype.hasColors=function(){for(var a in this.attributes)if(this.attributes[a].name===u.COLOR_PACKED)return!0;return!1};t.prototype.hasNormals=function(){for(var a in this.attributes){var b=this.attributes[a];if(b===g.NORMAL_SPHEREMAPPED||b===g.NORMAL_FLOATS||b===g.NORMAL||b===g.NORMAL_OCT16)return!0}return!1};class ea{constructor(a,
b,c){this.name=a;this.box=b;this.tileSize=c;this.level=this.name.length-1;this.data=new Float32Array(c*c);this.data.fill(-Infinity);this.children=[];this.mipMap=[this.data];this.mipMapNeedsUpdate=!0}createMipMap(){this.mipMap=[this.data];for(var a=this.tileSize,b=parseInt(a/2),c=this.data;1<b;){for(var f=new Float32Array(b*b),d=0;d<b;d++)for(var l=0;l<b;l++){var k=c[2*d+2*l*a],v=c[2*d+2*l*a+a],h=c[2*d+1+2*l*a],m=c[2*d+1+2*l*a+a],[n,e]=[0,0];isFinite(k)&&(n+=k,e+=1);isFinite(v)&&(n+=v,e+=1);isFinite(h)&&
(n+=h,e+=1);isFinite(m)&&(n+=m,e+=1);n/=e;f[d+l*b]=n}this.mipMap.push(f);c=f;a=b;b=parseInt(b/2)}this.mipMapNeedsUpdate=!1}uv(a){var b=this.box.getSize(new THREE.Vector3);return[(a.x-this.box.min.x)/b.x,(a.y-this.box.min.y)/b.y]}heightAtMipMapLevel(a,b){a=this.uv(a);var c=parseInt(this.tileSize/parseInt(Math.pow(2,b))),f=this.mipMap[b];b=Math.min(a[0]*c,c-1);a=Math.min(a[1]*c,c-1);var d=b%1,l=a%1,[k,v]=[Math.floor(b),Math.ceil(b)],[h,m]=[Math.floor(a),Math.ceil(a)];b=f[k+c*h];a=f[k+c*m];var n=f[v+
c*h];c=f[v+c*m];f=isFinite(b)?(1-d)*(1-l):0;var e=isFinite(a)?(1-d)*l:0,p=isFinite(n)?d*(1-l):0;d=isFinite(c)?d*l:0;l=f+e+p+d;f/=l;e/=l;p/=l;d/=l;if(0===l)return null;l=0;isFinite(b)&&(l+=b*f);isFinite(a)&&(l+=a*e);isFinite(n)&&(l+=n*p);isFinite(c)&&(l+=c*d);return l}height(a){for(var b=null,c=0;c<this.mipMap.length&&(b=this.heightAtMipMapLevel(a,c),null===b);c++);return b}traverse(a,b=0){a(this,b);for(var c of this.children.filter(a=>void 0!==a))c.traverse(a,b+1)}}class qa{constructor(a){this.pointcloud=
a;this.boundingBox=this.matrix=null;this.tileSize=64;this.root=null;this.version=0}expandAndFindByBox(a,b){if(0===b)return[this.root];for(var c=[],f=[this.root];0<f.length;){var d=f.pop(),l=d.box.getSize(new THREE.Vector3),k=(a.min.x-d.box.min.x)/l.x,v=(a.min.y-d.box.min.y)/l.y,h=(a.max.x-d.box.max.x)/l.x,m=(a.max.y-d.box.max.y)/l.y;k=.5>k?0:1;v=.5>v?0:1;h=.5>h?0:1;m=.5>m?0:1;k=0===k&&0===v&&1===h&&1===m?[0,1,2,3]:k===h&&v===m?[k<<1|v]:[k<<1|v,h<<1|m];for(var n of k)void 0===d.children[n]&&(k=d.box.clone(),
0<(n&2)?k.min.x+=l.x/2:k.max.x-=l.x/2,0<(n&1)?k.min.y+=l.y/2:k.max.y-=l.y/2,k=new ea(d.name+n,k,this.tileSize),d.children[n]=k),k=d.children[n],k.level<b?f.push(k):c.push(k)}return c}childIndex(a){var [b,c]=a.map(a=>.5>a?0:1);return b<<1|c}height(a){if(!this.root)return 0;for(var b=null,c=[this.root];;){var f=c[c.length-1],d=f.height(a);null!==d&&(b=d);d=f.uv(a);d=this.childIndex(d);if(f.children[d])c.push(f.children[d]);else break}return b+this.pointcloud.position.z}update(a){null!==this.matrix&&
this.matrix.equals(this.pointcloud.matrixWorld)||(this.matrix=this.pointcloud.matrixWorld.clone(),this.boundingBox=this.pointcloud.boundingBox.clone().applyMatrix4(this.matrix),this.root=new ea('r',this.boundingBox,this.tileSize),this.version++);var b=null,c;for(c of a)if(void 0===c.demVersion||c.demVersion<this.version){b=c;break}if(null!==b){var f=b.getBoundingBox().clone().applyMatrix4(this.matrix),d=f.getSize(new THREE.Vector3),l=this.expandAndFindByBox(f,b.getLevel());b.demVersion=this.version;
a=b.geometryNode.geometry.attributes.position.array;b={boundingBox:{min:b.getBoundingBox().min.toArray(),max:b.getBoundingBox().max.toArray()},position:(new Float32Array(a)).buffer};var k=this;w.workerPool.runTask(A.DEM,function(a){a=new Float32Array(a.data.dem.data);for(var b of l){for(var c=b.box.getSize(new THREE.Vector3),v=0;v<k.tileSize;v++)for(var e=0;e<k.tileSize;e++){var p=k.tileSize*(b.box.min.x+v/(k.tileSize-1)*c.x-f.min.x)/d.x,g=k.tileSize*(b.box.min.y+e/(k.tileSize-1)*c.y-f.min.y)/d.y;
0>p||p>k.tileSize||0>g||g>k.tileSize||(p=Math.min(Math.floor(p),k.tileSize-1),g=Math.min(Math.floor(g),k.tileSize-1),b.data[v+k.tileSize*e]=a[p+k.tileSize*g])}b.createMipMap();b.mipMapNeedsUpdate=!0}},b,[b.position])}}}class U{constructor(){this.needsTransformUpdate=!0}getChildren(){}getBoundingBox(){}isLoaded(){}isGeometryNode(){}isTreeNode(){}getLevel(){}getBoundingSphere(){}}class R extends THREE.Object3D{constructor(){super();this.dem=new qa(this)}initialized(){return null!==this.root}}class ra{constructor(){this.spacing=
0;this.nodes=this.root=this.boundingBox=null;this.pointAttributes={};this.hierarchyStepSize=-1;this.serverURL=this.boundingSphere=this.projection=this.offset=this.baseDepth=this.schema=this.loader=null;this.normalize={color:!1,intensity:!1}}}y.IDCount=0;y.prototype=Object.create(U.prototype);y.prototype.isGeometryNode=function(){return!0};y.prototype.isTreeNode=function(){return!1};y.prototype.isLoaded=function(){return this.loaded};y.prototype.getBoundingSphere=function(){return this.boundingSphere};
y.prototype.getBoundingBox=function(){return this.boundingBox};y.prototype.getLevel=function(){return this.level};y.prototype.getChildren=function(){for(var a=[],b=0;8>b;++b)this.children[b]&&a.push(this.children[b]);return a};y.prototype.getURL=function(){var a=this.greyhoundBounds;a=''+this.pcoGeometry.serverURL+'read?depthBegin='+(this.baseLoaded?this.level+this.pcoGeometry.baseDepth:0)+'&depthEnd='+(this.level+this.pcoGeometry.baseDepth+1)+'&bounds=['+(a.min.x+','+a.min.y+','+a.min.z+','+a.max.x+
','+a.max.y+','+a.max.z)+']&schema='+JSON.stringify(this.pcoGeometry.schema)+'&compress=true';this.scale&&(a+='&scale='+this.scale);if(this.greyhoundOffset){var b=this.greyhoundOffset;a+='&offset=['+b.x+','+b.y+','+b.z+']'}this.baseLoaded||(this.baseLoaded=!0);return a};y.prototype.addChild=function(a){this.children[a.index]=a;a.parent=this};y.prototype.load=function(){!0===this.loading||!0===this.loaded||w.numNodesLoading>=w.maxNodesLoading||(this.loading=!0,w.numNodesLoading++,0===this.level%this.pcoGeometry.hierarchyStepSize&&
this.hasChildren?this.loadHierarchyThenPoints():this.loadPoints())};y.prototype.loadPoints=function(){this.pcoGeometry.loader.load(this)};y.prototype.loadHierarchyThenPoints=function(){var a=[0,2,1,3,4,6,5,7],b=function(b){var c=0;Object.keys(b).forEach(function(b){'swd'===b?c+=1<<a[0]:'nwd'===b?c+=1<<a[1]:'swu'===b?c+=1<<a[2]:'nwu'===b?c+=1<<a[3]:'sed'===b?c+=1<<a[4]:'ned'===b?c+=1<<a[5]:'seu'===b?c+=1<<a[6]:'neu'===b&&(c+=1<<a[7])});return c},c=function(d,f,l){var k,h;Object.keys(d).forEach(function(v){if('n'!==
v){switch(v){case 'swd':k=d.swd;h=f+a[0];break;case 'nwd':k=d.nwd;h=f+a[1];break;case 'swu':k=d.swu;h=f+a[2];break;case 'nwu':k=d.nwu;h=f+a[3];break;case 'sed':k=d.sed;h=f+a[4];break;case 'ned':k=d.ned;h=f+a[5];break;case 'seu':k=d.seu;h=f+a[6];break;case 'neu':k=d.neu,h=f+a[7]}l.push({children:b(k),numPoints:k.n,name:h});c(k,h,l)}})};if(0===this.level%this.pcoGeometry.hierarchyStepSize){var f=this.level+this.pcoGeometry.baseDepth,d=this.greyhoundBounds,l=''+this.pcoGeometry.serverURL+'hierarchy?bounds=['+
(d.min.x+','+d.min.y+','+d.min.z+','+d.max.x+','+d.max.y+','+d.max.z)+']&depthBegin='+f+'&depthEnd='+(f+this.pcoGeometry.hierarchyStepSize+2);this.scale&&(l+='&scale='+this.scale);this.greyhoundOffset&&(f=this.greyhoundOffset,l+='&offset=['+f.x+','+f.y+','+f.z+']');var k=this,v=new XMLHttpRequest;v.overrideMimeType('text/plain');v.open('GET',l,!0);v.onload=function(a){try{var b=JSON.parse(v.responseText)||{};a=[];k.numPoints=b.n;c(b,k.name,a);b={};b[k.name]=k;for(var d=k.pcoGeometry,f=0;f<a.length;f++){var l=
a[f].name,h=a[f].numPoints,e=parseInt(l.charAt(l.length-1)),g=l.substring(0,l.length-1),x=b[g],t=l.length-1,u=E.createChildAABB(x.boundingBox,e),z=new y(l,d,u,k.scale,k.offset);z.level=t;z.numPoints=h;z.hasChildren=0<a[f].children;z.spacing=d.spacing/Math.pow(2,t);x.addChild(z);b[l]=z}k.loadPoints()}catch(Ia){w.numNodesLoading--,console.error('Potree: Exception thrown parsing points.',Ia)}};v.onerror=function(a){console.log('Potree: Failed to load file! HTTP status '+v.status+', file:'+l,a)};v.send(null)}};
y.prototype.getNumPoints=function(){return this.numPoints};y.prototype.dispose=function(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}};Object.assign(y.prototype,THREE.EventDispatcher.prototype);z.prototype.newerThan=function(a){a=new z(a);return this.versionMajor>a.versionMajor||this.versionMajor===a.versionMajor&&this.versionMinor>
a.versionMinor?!0:!1};z.prototype.equalOrHigher=function(a){a=new z(a);return this.versionMajor>a.versionMajor||this.versionMajor===a.versionMajor&&this.versionMinor>=a.versionMinor?!0:!1};z.prototype.upTo=function(a){return!this.newerThan(a)};class sa{constructor(a,b,c){this.version='string'===typeof a?new z(a):a;this.boundingBox=b;this.scale=c}load(a){if(!a.loaded){var b=this,c=a.getURL(),f=new XMLHttpRequest;f.overrideMimeType('text/plain');f.open('GET',c,!0);f.responseType='arraybuffer';f.overrideMimeType('text/plain; charset=x-user-defined');
f.onload=function(){try{b.parse(a,f.response)}catch(d){console.error('Potree: Exception thrown parsing points.',d),w.numNodesLoading--}};f.onerror=function(a){w.numNodesLoading--;console.error('Potree: Failed to load file.',f,c)};f.send(null)}}parse(a,b){var c=(new DataView(b,b.byteLength-4,4)).getUint32(0,!0),f=a.pcoGeometry.pointAttributes;a.numPoints=c;c=a.boundingBox;var d=new THREE.Vector3;d=a.pcoGeometry.boundingBox.getCenter(d).sub(a.boundingBox.min);b={buffer:b,pointAttributes:f,version:this.version.version,
schema:a.pcoGeometry.schema,min:[c.min.x,c.min.y,c.min.z],max:[c.max.x,c.max.y,c.max.z],offset:d.toArray(),scale:this.scale,normalize:a.pcoGeometry.normalize};w.workerPool.runTask(A.GREYHOUND,function(b){b=b.data;var c=b.attributeBuffers,d=new THREE.Box3((new THREE.Vector3).fromArray(b.tightBoundingBox.min),(new THREE.Vector3).fromArray(b.tightBoundingBox.max)),f=new THREE.BufferGeometry,l;for(l in c){var e=c[l].buffer;parseInt(l)===u.POSITION_CARTESIAN?f.setAttribute('position',new THREE.BufferAttribute(new Float32Array(e),
3)):parseInt(l)===u.COLOR_PACKED?f.setAttribute('color',new THREE.BufferAttribute(new Uint8Array(e),4,!0)):parseInt(l)===u.INTENSITY?f.setAttribute('intensity',new THREE.BufferAttribute(new Float32Array(e),1)):parseInt(l)===u.CLASSIFICATION?f.setAttribute('classification',new THREE.BufferAttribute(new Uint8Array(e),1)):parseInt(l)===u.NORMAL_SPHEREMAPPED?f.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(e),3)):parseInt(l)===u.NORMAL_OCT16?f.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(e),
3)):parseInt(l)===u.NORMAL?f.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(e),3)):parseInt(l)===u.INDICES?(e=new THREE.BufferAttribute(new Uint8Array(e),4),e.normalized=!0,f.setAttribute('indices',e)):parseInt(l)===u.SPACING&&(e=new THREE.BufferAttribute(new Float32Array(e),1),f.setAttribute('spacing',e))}d.max.sub(d.min);d.min.set(0,0,0);a.numPoints=b.numPoints;a.geometry=f;a.mean=new THREE.Vector3(...b.mean);a.tightBoundingBox=d;a.loaded=!0;a.loading=!1;w.numNodesLoading--},b,
[b.buffer])}}class H{static getQueryParam(a){a=a.replace(/[[\]]/g,'\\$&');return(a=(new RegExp('[?&]'+a+'(=([^&#]*)|&|#|$)')).exec(window.location.href))?a[2]?decodeURIComponent(a[2].replace(/\+/g,' ')):'':null}static createSchema(a){var b=[{name:'X',size:4,type:'signed'},{name:'Y',size:4,type:'signed'},{name:'Z',size:4,type:'signed'}];a.forEach(function(a){'COLOR_PACKED'===a?(b.push({name:'Red',size:2,type:'unsigned'}),b.push({name:'Green',size:2,type:'unsigned'}),b.push({name:'Blue',size:2,type:'unsigned'})):
'INTENSITY'===a?b.push({name:'Intensity',size:2,type:'unsigned'}):'CLASSIFICATION'===a&&b.push({name:'Classification',size:1,type:'unsigned'})});return b}static fetch(a,b){var c=new XMLHttpRequest;c.overrideMimeType('text/plain');c.open('GET',a,!0);c.onreadystatechange=function(){4===c.readyState&&(200===c.status||0===c.status?b(null,c.responseText):b(c.responseText))};c.send(null)}static fetchBinary(a,b){var c=new XMLHttpRequest;c.overrideMimeType('text/plain');c.open('GET',a,!0);c.responseType=
'arraybuffer';c.onreadystatechange=function(){4===c.readyState&&(200===c.status||0===c.status?b(null,c.response):b(c.responseText))};c.send(null)}static pointSizeFrom(a){return a.reduce((a,c)=>a+c.size,0)}static getNormalization(a,b,c){var f=[{name:'X',size:4,type:'floating'},{name:'Y',size:4,type:'floating'},{name:'Z',size:4,type:'floating'},{name:'Red',size:2,type:'unsigned'},{name:'Green',size:2,type:'unsigned'},{name:'Blue',size:2,type:'unsigned'},{name:'Intensity',size:2,type:'unsigned'}];a=
a+'read?depth='+b+'&schema='+JSON.stringify(f);H.fetchBinary(a,function(a,b){if(a)throw Error(a);a=new DataView(b);b=b.byteLength-4;for(var d=H.pointSizeFrom(f),l=!1,h=!1,e=0;e<b;e+=d){if(255<a.getUint16(e+12,!0)||255<a.getUint16(e+14,!0)||255<a.getUint16(e+16,!0))l=!0;255<a.getUint16(e+18,!0)&&(h=!0);if(l&&h)break}c(null,{color:l,intensity:h})})}}E.loadInfoJSON=function(a,b){};E.load=function(a,b){try{var c=a.split('greyhound://')[1];1===c.split('http://').length&&1===c.split('https://').length&&
(c='http://'+c);H.fetch(c+'info',function(a,d){if(a)throw Error(a);a=JSON.parse(d);var f=new z('1.4'),k=a.bounds;d=a.scale||.01;Array.isArray(d)&&(d=Math.min(d[0],d[1],d[2]));H.getQueryParam('scale')&&(d=parseFloat(H.getQueryParam('scale')));var e=Math.max(8,a.baseDepth),h=['POSITION_CARTESIAN'],m=!1,n=!1,g=!1;a.schema.forEach(function(a){'Intensity'===a.name&&h.push('INTENSITY');'Classification'===a.name&&h.push('CLASSIFICATION');'Red'===a.name?m=!0:'Green'===a.name?n=!0:'Blue'===a.name&&(g=!0)});
m&&n&&g&&h.push('COLOR_PACKED');var p=new ra;p.serverURL=c;p.spacing=(k[3]-k[0])/Math.pow(2,e);p.baseDepth=e;p.hierarchyStepSize=5;p.schema=H.createSchema(h);e=H.pointSizeFrom(p.schema);p.pointAttributes=new t(h);p.pointAttributes.byteSize=e;k=new THREE.Box3((new THREE.Vector3).fromArray(k,0),(new THREE.Vector3).fromArray(k,3));e=k.min.clone();k.max.sub(k.min);k.min.set(0,0,0);p.projection=a.srs;p.boundingBox=k;p.boundingSphere=k.getBoundingSphere(new THREE.Sphere);p.scale=d;p.offset=e;p.loader=new sa(f,
k,p.scale);f={};d=new y('r',p,k,d,e);d.level=0;d.hasChildren=!0;d.numPoints=a.numPoints;d.spacing=p.spacing;p.root=d;p.root.load();f.r=d;p.nodes=f;H.getNormalization(c,a.baseDepth,function(a,c){c.color&&(p.normalize.color=!0);c.intensity&&(p.normalize.intensity=!0);b(p)})})}catch(f){console.log('Potree: Loading failed.',a,f),b()}};E.loadPointAttributes=function(a){a=a.pointAttributes;for(var b=new t,c=0;c<a.length;c++)b.add(g[a[c]]);return b};E.createChildAABB=function(a,b){var c=a.min;a=a.max;var f=
(new THREE.Vector3).copy(a).sub(c).multiplyScalar(.5),d=new THREE.Vector3(f.x,0,0),l=new THREE.Vector3(0,f.y,0),k=new THREE.Vector3(0,0,f.z),e=c,h=(new THREE.Vector3).add(c).add(f);1===b?(c=(new THREE.Vector3).copy(e).add(k),a=(new THREE.Vector3).copy(h).add(k)):3===b?(c=(new THREE.Vector3).copy(e).add(k).add(l),a=(new THREE.Vector3).copy(h).add(k).add(l)):0===b?(c=e,a=h):2===b?(c=(new THREE.Vector3).copy(e).add(l),a=(new THREE.Vector3).copy(h).add(l)):5===b?(c=(new THREE.Vector3).copy(e).add(k).add(d),
a=(new THREE.Vector3).copy(h).add(k).add(d)):7===b?(c=(new THREE.Vector3).copy(e).add(f),a=(new THREE.Vector3).copy(h).add(f)):4===b?(c=(new THREE.Vector3).copy(e).add(d),a=(new THREE.Vector3).copy(h).add(d)):6===b&&(c=(new THREE.Vector3).copy(e).add(d).add(l),a=(new THREE.Vector3).copy(h).add(d).add(l));return new THREE.Box3(c,a)};class ta{constructor(a,b,c){this.version='string'===typeof a?new z(a):a;this.boundingBox=b;this.scale=c}load(a){if(!a.loaded){var b=a.getURL();this.version.equalOrHigher('1.4')&&
(b+='.bin');var c=this,f=new XMLHttpRequest;f.open('GET',b,!0);f.responseType='arraybuffer';f.overrideMimeType('text/plain; charset=x-user-defined');f.onload=function(){try{c.parse(a,f.response)}catch(d){w.numNodesLoading--,console.error('Potree: Exception thrown parsing points.',d)}};f.onerror=function(a){w.numNodesLoading--;console.error('Potree: Failed to load file.',f,b)};f.send(null)}}parse(a,b){var c=a.pcoGeometry.pointAttributes,f=b.byteLength/a.pcoGeometry.pointAttributes.byteSize;this.version.upTo('1.5')&&
(a.numPoints=f);b={buffer:b,pointAttributes:c,version:this.version.version,min:[a.boundingBox.min.x,a.boundingBox.min.y,a.boundingBox.min.z],offset:[a.pcoGeometry.offset.x,a.pcoGeometry.offset.y,a.pcoGeometry.offset.z],scale:this.scale,spacing:a.spacing,hasChildren:a.hasChildren,name:a.name};w.workerPool.runTask(A.BINARY_DECODER,function(b){var d=b.data;if(void 0!==d.error)w.numNodesLoading--,console.error('Potree: Binary worker error.',d);else{var f=d.attributeBuffers,e=new THREE.Box3((new THREE.Vector3).fromArray(d.tightBoundingBox.min),
(new THREE.Vector3).fromArray(d.tightBoundingBox.max)),h=new THREE.BufferGeometry,m;for(m in f){var n=f[m].buffer;parseInt(m)===u.POSITION_CARTESIAN?h.setAttribute('position',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(m)===u.COLOR_PACKED?h.setAttribute('color',new THREE.BufferAttribute(new Uint8Array(n),4,!0)):parseInt(m)===u.INTENSITY?h.setAttribute('intensity',new THREE.BufferAttribute(new Float32Array(n),1)):parseInt(m)===u.CLASSIFICATION?h.setAttribute('classification',new THREE.BufferAttribute(new Uint8Array(n),
1)):parseInt(m)===u.NORMAL_SPHEREMAPPED?h.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(m)===u.NORMAL_OCT16?h.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(m)===u.NORMAL?h.setAttribute('normal',new THREE.BufferAttribute(new Float32Array(n),3)):parseInt(m)===u.INDICES?(n=new THREE.BufferAttribute(new Uint8Array(n),4),n.normalized=!0,h.setAttribute('indices',n)):parseInt(m)===u.SPACING&&(n=new THREE.BufferAttribute(new Float32Array(n),
1),h.setAttribute('spacing',n))}e.max.sub(e.min);e.min.set(0,0,0);a.numPoints=b.data.buffer.byteLength/c.byteSize;a.geometry=h;a.mean=new THREE.Vector3(...d.mean);a.tightBoundingBox=e;a.loaded=!0;a.loading=!1;a.estimatedSpacing=d.estimatedSpacing;w.numNodesLoading--}},b,[b.buffer])}}var ja=[function(a){return{position:[a.getInt32(0,!0),a.getInt32(4,!0),a.getInt32(8,!0)],intensity:a.getUint16(12,!0),classification:a.getUint8(16,!0)}},function(a){return{position:[a.getInt32(0,!0),a.getInt32(4,!0),a.getInt32(8,
!0)],intensity:a.getUint16(12,!0),classification:a.getUint8(16,!0)}},function(a){return{position:[a.getInt32(0,!0),a.getInt32(4,!0),a.getInt32(8,!0)],intensity:a.getUint16(12,!0),classification:a.getUint8(16,!0),color:[a.getUint16(20,!0),a.getUint16(22,!0),a.getUint16(24,!0)]}},function(a){return{position:[a.getInt32(0,!0),a.getInt32(4,!0),a.getInt32(8,!0)],intensity:a.getUint16(12,!0),classification:a.getUint8(16,!0),color:[a.getUint16(28,!0),a.getUint16(30,!0),a.getUint16(32,!0)]}}];Q.prototype.open=
function(){this.readOffset=0;return new Promise(function(a,b){setTimeout(a,0)})};Q.prototype.getHeader=function(){var a=this;return new Promise(function(b,c){setTimeout(function(){var c=a.arraybuffer,d={};d.pointsOffset=I(c,Uint32Array,96);d.pointsFormatId=I(c,Uint8Array,104);d.pointsStructSize=I(c,Uint16Array,105);d.pointsCount=I(c,Uint32Array,107);var l=131;d.scale=I(c,Float64Array,l,3);l+=24;d.offset=I(c,Float64Array,l,3);c=I(c,Float64Array,l+24,6);d.maxs=[c[0],c[2],c[4]];d.mins=[c[1],c[3],c[5]];
a.header=d;b(a.header)},0)})};Q.prototype.readData=function(a,b,c){var f=this;return new Promise(function(b,l){setTimeout(function(){if(!f.header)return l(Error('Cannot start reading data till a header request is issued'));if(1>=c){a=Math.min(a,f.header.pointsCount-f.readOffset);var d=f.header.pointsOffset+f.readOffset*f.header.pointsStructSize;b({buffer:f.arraybuffer.slice(d,d+a*f.header.pointsStructSize),count:a,hasMoreData:f.readOffset+a<f.header.pointsCount});f.readOffset+=a}else{for(var e=Math.min(a*
c,f.header.pointsCount-f.readOffset),h=0,m=new Uint8Array(Math.ceil(e/c)*f.header.pointsStructSize),n=0;n<e;n++)0===n%c&&(d=f.header.pointsOffset+f.readOffset*f.header.pointsStructSize,d=new Uint8Array(f.arraybuffer,d,f.header.pointsStructSize),m.set(d,h*f.header.pointsStructSize),h++),f.readOffset++;b({buffer:m.buffer,count:h,hasMoreData:f.readOffset<f.header.pointsCount})}},0)})};Q.prototype.close=function(){var a=this;return new Promise(function(b,c){a.arraybuffer=null;setTimeout(b,0)})};T.prototype.open=
function(){var a=this;return new Promise(function(b,c){a.dorr({type:'open',arraybuffer:a.arraybuffer},function(a){if(1!==a.status)return c(Error('Failed to open file'));b(!0)})})};T.prototype.getHeader=function(){var a=this;return new Promise(function(b,c){a.dorr({type:'header'},function(a){if(1!==a.status)return c(Error('Failed to get header'));b(a.header)})})};T.prototype.readData=function(a,b,c){var f=this;return new Promise(function(d,l){f.dorr({type:'read',count:a,offset:b,skip:c},function(a){if(1!==
a.status)return l(Error('Failed to read data'));d({buffer:a.buffer,count:a.count,hasMoreData:a.hasMoreData})})})};T.prototype.close=function(){var a=this;return new Promise(function(b,c){a.dorr({type:'close'},function(a){if(1!==a.status)return c(Error('Failed to close file'));b(!0)})})};J.prototype.determineFormat=function(){var a=I(this.arraybuffer,Uint8Array,104),b=(a&128)>>7,c=(a&64)>>6;if(1===b&&1===c)throw Error('Old style compression not supported');this.formatId=a&63;this.isCompressed=1===
b||1===c};J.prototype.determineVersion=function(){var a=new Int8Array(this.arraybuffer,24,2);this.version=10*a[0]+a[1];this.versionAsString=a[0]+'.'+a[1]};J.prototype.open=function(){return this.loader.open()};J.prototype.getHeader=function(){return this.loader.getHeader()};J.prototype.readData=function(a,b,c){return this.loader.readData(a,b,c)};J.prototype.close=function(){return this.loader.close()};ca.prototype.getPoint=function(a){if(0>a||a>=this.pointsCount)throw Error('Point index out of range');
return this.decoder(new DataView(this.arrayb,a*this.pointSize,this.pointSize))};class ua{constructor(a){this.version='string'===typeof a?new z(a):a}load(a){if(!a.loaded){var b=a.pcoGeometry.pointAttributes,c=a.getURL();this.version.equalOrHigher('1.4')&&(c+='.'+b.toLowerCase());var f=this,d=new XMLHttpRequest;d.open('GET',c,!0);d.responseType='arraybuffer';d.overrideMimeType('text/plain; charset=x-user-defined');d.onload=function(){if(d.response instanceof ArrayBuffer)try{f.parse(a,d.response)}catch(l){console.error('Potree: Exception thrown parsing points.',
l),w.numNodesLoading--}else w.numNodesLoading--,console.log('Potree: LASLAZLoader xhr response is not a ArrayBuffer.')};d.onerror=function(){w.numNodesLoading--;console.log('Potree: LASLAZLoader failed to load file, '+d.status+', file: '+c)};d.send(null)}}parse(a,b){var c=new J(b),f=new Ka(a);c.open().then(a=>{c.isOpen=!0;return c}).catch(a=>{console.log('Potree: Failed to open file.')}).then(a=>a.getHeader().then(function(b){return[a,b]})).then(a=>{let b=a[0],c=a[1],d=0;var h=function(){return b.readData(1E6,
0,1).then(function(a){f.push(new ca(a.buffer,c.pointsFormatId,c.pointsStructSize,a.count,c.scale,c.offset,c.mins,c.maxs));d+=a.count;if(a.hasMoreData)return h();c.totalRead=d;c.versionAsString=b.versionAsString;c.isCompressed=b.isCompressed;return[b,c,f]})};return h()}).then(a=>{let b=a[0];return b.close().then(function(){b.isOpen=!1;return a.slice(1)}).catch(a=>{if(b.isOpen)return b.close().then(function(){b.isOpen=!1;throw a;});throw a;})})}handle(a,b){}}class Ka{constructor(a){this.node=a}push(a){var b=
this,c={buffer:a.arrayb,numPoints:a.pointsCount,pointSize:a.pointSize,pointFormatID:2,scale:a.scale,offset:a.offset,mins:a.mins,maxs:a.maxs},f=w.workerPool.getWorker(A.LAS_DECODER);f.onmessage=function(c){var d=new THREE.BufferGeometry,k=a.pointsCount,e=new Float32Array(c.data.position),h=new Uint8Array(c.data.color),m=new Float32Array(c.data.intensity),n=new Uint8Array(c.data.classification),g=new Uint8Array(c.data.returnNumber),p=new Uint8Array(c.data.numberOfReturns),r=new Uint16Array(c.data.pointSourceID),
t=new Uint8Array(c.data.indices);d.setAttribute('position',new THREE.BufferAttribute(e,3));d.setAttribute('color',new THREE.BufferAttribute(h,4,!0));d.setAttribute('intensity',new THREE.BufferAttribute(m,1));d.setAttribute('classification',new THREE.BufferAttribute(n,1));d.setAttribute('returnNumber',new THREE.BufferAttribute(g,1));d.setAttribute('numberOfReturns',new THREE.BufferAttribute(p,1));d.setAttribute('pointSourceID',new THREE.BufferAttribute(r,1));d.setAttribute('indices',new THREE.BufferAttribute(t,
4));d.attributes.indices.normalized=!0;e=new THREE.Box3((new THREE.Vector3).fromArray(c.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(c.data.tightBoundingBox.max));d.boundingBox=b.node.boundingBox;b.node.tightBoundingBox=e;b.node.geometry=d;b.node.numPoints=k;b.node.loaded=!0;b.node.loading=!1;w.numNodesLoading--;b.node.mean=new THREE.Vector3(...c.data.mean);w.workerPool.returnWorker(A.LAS_DECODER,f)};f.postMessage(c,[c.buffer])}}class va{constructor(){this.octreeDir=this.url=null;this.spacing=
0;this.pointAttributes=this.nodes=this.root=this.boundingBox=null;this.hierarchyStepSize=-1;this.loader=null}}class N extends U{constructor(a,b,c){super();this.id=N.IDCount++;this.name=a;this.index=parseInt(a.charAt(a.length-1));this.pcoGeometry=b;this.geometry=null;this.boundingBox=c;this.boundingSphere=c.getBoundingSphere(new THREE.Sphere);this.children={};this.numPoints=0;this.level=null;this.loaded=!1;this.oneTimeDisposeHandlers=[]}isGeometryNode(){return!0}getLevel(){return this.level}isTreeNode(){return!1}isLoaded(){return this.loaded}getBoundingSphere(){return this.boundingSphere}getBoundingBox(){return this.boundingBox}getChildren(){for(var a=
[],b=0;8>b;b++)this.children[b]&&a.push(this.children[b]);return a}getURL(){var a='',b=this.pcoGeometry.loader.version;b.equalOrHigher('1.5')?a=this.pcoGeometry.octreeDir+'/'+this.getHierarchyPath()+'/'+this.name:b.equalOrHigher('1.4')?a=this.pcoGeometry.octreeDir+'/'+this.name:b.upTo('1.3')&&(a=this.pcoGeometry.octreeDir+'/'+this.name);return a}getHierarchyPath(){for(var a='r/',b=this.pcoGeometry.hierarchyStepSize,c=this.name.substr(1),f=Math.floor(c.length/b),d=0;d<f;d++)a+=c.substr(d*b,b)+'/';
return a=a.slice(0,-1)}addChild(a){this.children[a.index]=a;a.parent=this}load(){if(!(!0===this.loading||!0===this.loaded||w.numNodesLoading>=w.maxNodesLoading)){this.loading=!0;w.numNodesLoading++;try{this.pcoGeometry.loader.version.equalOrHigher('1.5')?0===this.level%this.pcoGeometry.hierarchyStepSize&&this.hasChildren?this.loadHierachyThenPoints():this.loadPoints():this.loadPoints()}catch(a){w.numNodesLoading--,console.error('Potree: Exception thrown loading points file.',a)}}}loadPoints(){this.pcoGeometry.loader.load(this)}loadHierachyThenPoints(){var a=
this;if(0===a.level%a.pcoGeometry.hierarchyStepSize){var b=a.pcoGeometry.octreeDir+'/'+a.getHierarchyPath()+'/'+a.name+'.hrc',c=new XMLHttpRequest;c.open('GET',b,!0);c.responseType='arraybuffer';c.overrideMimeType('text/plain; charset=x-user-defined');c.onload=function(b){try{var d=c.response,f=new DataView(d);b=[];var k=f.getUint8(0),e=f.getUint32(1,!0);a.numPoints=e;b.push({children:k,numPoints:e,name:a.name});k=[];for(e=5;0<b.length;){for(var h=b.shift(),m=1,n=0;8>n;n++){if(0!==(h.children&m)){var g=
h.name+n,p=f.getUint8(e),r=f.getUint32(e+1,!0);b.push({children:p,numPoints:r,name:g});k.push({children:p,numPoints:r,name:g});e+=5}m*=2}if(e===d.byteLength)break}d={};d[a.name]=a;var t=a.pcoGeometry;for(n=0;n<k.length;n++){var u=k[n].name,x=k[n].numPoints,y=parseInt(u.charAt(u.length-1)),z=u.substring(0,u.length-1),A=d[z],B=u.length-1,C=Y.createChildAABB(A.boundingBox,y),D=new N(u,t,C);D.level=B;D.numPoints=x;D.hasChildren=0<k[n].children;D.spacing=t.spacing/Math.pow(2,B);A.addChild(D);d[u]=D}a.loadPoints()}catch(Ha){w.numNodesLoading--,
console.error('Potree: Exception thrown parsing points.',Ha)}};c.onerror=function(a){w.numNodesLoading--;console.error('Potree: Failed to load file.',c.status,b,a)};c.send(null)}}getNumPoints(){return this.numPoints}dispose(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}}}N.IDCount=0;Object.assign(N.prototype,THREE.EventDispatcher.prototype);
class Y{static load(a,b){var c=new va;c.url=a;var f=new XMLHttpRequest;f.overrideMimeType('text/plain');f.open('GET',a,!0);f.onload=function(){var d=JSON.parse(f.responseText),l=new z(d.version);0===d.octreeDir.indexOf('http')?c.octreeDir=d.octreeDir:c.octreeDir=a+'/../'+d.octreeDir;c.spacing=d.spacing;c.hierarchyStepSize=d.hierarchyStepSize;c.pointAttributes=d.pointAttributes;var k=new THREE.Vector3(d.boundingBox.lx,d.boundingBox.ly,d.boundingBox.lz),e=new THREE.Vector3(d.boundingBox.ux,d.boundingBox.uy,
d.boundingBox.uz),h=new THREE.Box3(k,e);e=h.clone();d.tightBoundingBox&&(e.min.copy(new THREE.Vector3(d.tightBoundingBox.lx,d.tightBoundingBox.ly,d.tightBoundingBox.lz)),e.max.copy(new THREE.Vector3(d.tightBoundingBox.ux,d.tightBoundingBox.uy,d.tightBoundingBox.uz)));k=k.clone();h.min.sub(k);h.max.sub(k);e.min.sub(k);e.max.sub(k);c.projection=d.projection;c.boundingBox=h;c.tightBoundingBox=e;c.boundingSphere=h.getBoundingSphere(new THREE.Sphere);c.tightBoundingSphere=e.getBoundingSphere(new THREE.Sphere);
c.offset=k;'LAS'===d.pointAttributes||'LAZ'===d.pointAttributes?c.loader=new ua(d.version):(c.loader=new ta(d.version,h,d.scale),c.pointAttributes=new t(c.pointAttributes));k={};e='r';h=new N(e,c,h);h.level=0;h.hasChildren=!0;h.spacing=c.spacing;h.numPoints=l.upTo('1.5')?d.hierarchy[0][1]:0;c.root=h;c.root.load();k[e]=h;if(l.upTo('1.4'))for(l=1;l<d.hierarchy.length;l++){e=d.hierarchy[l][0];var m=d.hierarchy[l][1];h=parseInt(e.charAt(e.length-1));var n=e.substring(0,e.length-1);n=k[n];var g=e.length-
1;h=Y.createChildAABB(n.boundingBox,h);h=new N(e,c,h);h.level=g;h.numPoints=m;h.spacing=c.spacing/Math.pow(2,g);n.addChild(h);k[e]=h}c.nodes=k;b(c)};f.onerror=function(c){w.numNodesLoading--;console.log('Potree: loading file failed.',a,c);b()};f.send(null)}static loadPointAttributes(a){a=a.pointAttributes;for(var b=new t,c=0;c<a.length;c++)b.add(g[a[c]]);return b}static createChildAABB(a,b){var c=a.min.clone();a=a.max.clone();var f=(new THREE.Vector3).subVectors(a,c);0<(b&1)?c.z+=f.z/2:a.z-=f.z/2;
0<(b&2)?c.y+=f.y/2:a.y-=f.y/2;0<(b&4)?c.x+=f.x/2:a.x-=f.x/2;return new THREE.Box3(c,a)}}class wa{load(a){if(!a.loaded){var b=a.url()+'.bin',c=new XMLHttpRequest;c.open('GET',b,!0);c.responseType='arraybuffer';c.overrideMimeType('text/plain; charset=x-user-defined');c.onreadystatechange=()=>{4===c.readyState&&(200===c.status||0===c.status?this.parse(a,c.response):console.log('Failed '+b+': '+c.status))};try{c.send(null)}catch(f){console.log('Failed request: '+f)}}}parse(a,b){var c=w.workerPool.getWorker(A.EPT_BINARY_DECODER);
c.onmessage=function(b){var d=new THREE.BufferGeometry,f=b.data.numPoints,k=new Float32Array(b.data.position);d.setAttribute('position',new THREE.BufferAttribute(k,3));k=new Uint8Array(b.data.indices);d.setAttribute('indices',new THREE.BufferAttribute(k,4));b.data.color&&(k=new Uint8Array(b.data.color),d.setAttribute('color',new THREE.BufferAttribute(k,4,!0)));b.data.intensity&&(k=new Float32Array(b.data.intensity),d.setAttribute('intensity',new THREE.BufferAttribute(k,1)));b.data.classification&&
(k=new Uint8Array(b.data.classification),d.setAttribute('classification',new THREE.BufferAttribute(k,1)));b.data.returnNumber&&(k=new Uint8Array(b.data.returnNumber),d.setAttribute('returnNumber',new THREE.BufferAttribute(k,1)));b.data.numberOfReturns&&(k=new Uint8Array(b.data.numberOfReturns),d.setAttribute('numberOfReturns',new THREE.BufferAttribute(k,1)));b.data.pointSourceId&&(k=new Uint16Array(b.data.pointSourceId),d.setAttribute('pointSourceID',new THREE.BufferAttribute(k,1)));d.attributes.indices.normalized=
!0;k=new THREE.Box3((new THREE.Vector3).fromArray(b.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(b.data.tightBoundingBox.max));a.doneLoading(d,k,f,new THREE.Vector3(...b.data.mean));w.workerPool.returnWorker(A.EPT_BINARY_DECODER,c)};b={buffer:b,schema:a.ept.schema,scale:a.ept.eptScale,offset:a.ept.eptOffset,mins:(a=>[a.x,a.y,a.z])(a.key.b.min)};c.postMessage(b,[b.buffer])}}class xa{load(a){if(!a.loaded){var b=a.url()+'.laz',c=new XMLHttpRequest;c.open('GET',b,!0);c.responseType='arraybuffer';
c.overrideMimeType('text/plain; charset=x-user-defined');c.onreadystatechange=()=>{4===c.readyState&&(200===c.status||0===c.status?this.parse(a,c.response):console.log('Failed '+b+': '+c.status))};c.send(null)}}parse(a,b){var c=new J(b),f=new La(a);c.open().then(()=>{c.isOpen=!0;return c.getHeader()}).then(b=>{var d=0,k=a=>[a.x,a.y,a.z],e=k(a.key.b.min),h=k(a.key.b.max),m=()=>c.readData(1E6,0,1).then(function(a){var l=new ca(a.buffer,b.pointsFormatId,b.pointsStructSize,a.count,b.scale,b.offset,e,
h);l.extraBytes=b.extraBytes;l.pointsFormatId=b.pointsFormatId;f.push(l);d+=a.count;if(a.hasMoreData)return m();b.totalRead=d;b.versionAsString=c.versionAsString;b.isCompressed=c.isCompressed;return null});return m()}).then(()=>c.close()).then(()=>c.isOpen=!1).catch(a=>{console.log('Error reading LAZ:',a);if(c.isOpen)c.close().then(()=>{c.isOpen=!1;throw a;});else throw a;})}}class La{constructor(a){this.node=a}push(a){var b=w.workerPool.getWorker(A.EPT_LAS_ZIP_DECODER);b.onmessage=c=>{var d=new THREE.BufferGeometry,
f=a.pointsCount,k=new Float32Array(c.data.position),e=new Uint8Array(c.data.color),h=new Float32Array(c.data.intensity),m=new Uint8Array(c.data.classification),g=new Uint8Array(c.data.returnNumber),q=new Uint8Array(c.data.numberOfReturns),p=new Uint16Array(c.data.pointSourceID),r=new Uint8Array(c.data.indices);d.setAttribute('position',new THREE.BufferAttribute(k,3));d.setAttribute('color',new THREE.BufferAttribute(e,4,!0));d.setAttribute('intensity',new THREE.BufferAttribute(h,1));d.setAttribute('classification',
new THREE.BufferAttribute(m,1));d.setAttribute('returnNumber',new THREE.BufferAttribute(g,1));d.setAttribute('numberOfReturns',new THREE.BufferAttribute(q,1));d.setAttribute('pointSourceID',new THREE.BufferAttribute(p,1));d.setAttribute('indices',new THREE.BufferAttribute(r,4));d.attributes.indices.normalized=!0;k=new THREE.Box3((new THREE.Vector3).fromArray(c.data.tightBoundingBox.min),(new THREE.Vector3).fromArray(c.data.tightBoundingBox.max));this.node.doneLoading(d,k,f,new THREE.Vector3(...c.data.mean));
w.workerPool.returnWorker(A.EPT_LAS_ZIP_DECODER,b)};var c={buffer:a.arrayb,numPoints:a.pointsCount,pointSize:a.pointSize,pointFormatID:a.pointsFormatId,scale:a.scale,offset:a.offset,mins:a.mins,maxs:a.maxs};b.postMessage(c,[c.buffer])}}class F{static toVector3(a,b){return(new THREE.Vector3).fromArray(a,b||0)}static toBox3(a){return new THREE.Box3(F.toVector3(a),F.toVector3(a,3))}static findDim(a,b){a=a.find(a=>a.name==b);if(!a)throw Error('Failed to find '+b+' in schema');return a}static sphereFrom(a){return a.getBoundingSphere(new THREE.Sphere)}}
class ya{constructor(a,b){let c=b.schema,f=b.bounds,d=b.boundsConforming;var l=[F.findDim(c,'X'),F.findDim(c,'Y'),F.findDim(c,'Z')];let k=l.map(a=>a.scale||1);l=l.map(a=>a.offset||0);this.eptScale=F.toVector3(k);this.eptOffset=F.toVector3(l);this.url=a;this.info=b;this.type='ept';this.schema=c;this.span=b.span||b.ticks;this.boundingBox=F.toBox3(f);this.tightBoundingBox=F.toBox3(d);this.offset=F.toVector3([0,0,0]);this.boundingSphere=F.sphereFrom(this.boundingBox);this.tightBoundingSphere=F.sphereFrom(this.tightBoundingBox);
this.version=new z('1.6');this.fallbackProjection=this.projection=null;b.srs&&b.srs.horizontal&&(this.projection=b.srs.authority+':'+b.srs.horizontal);b.srs.wkt&&(this.projection?this.fallbackProjection=b.srs.wkt:this.projection=b.srs.wkt);this.pointAttributes='LAZ';this.spacing=(this.boundingBox.max.x-this.boundingBox.min.x)/this.span;this.loader='binary'==(b.dataType||'laszip')?new wa:new xa}}class za{constructor(a,b,c,f,d,l){this.ept=a;this.b=b;this.d=c;this.x=f||0;this.y=d||0;this.z=l||0}name(){return this.d+
'-'+this.x+'-'+this.y+'-'+this.z}step(a,b,c){let f=this.b.min.clone(),d=this.b.max.clone(),l=(new THREE.Vector3).subVectors(d,f);a?f.x+=l.x/2:d.x-=l.x/2;b?f.y+=l.y/2:d.y-=l.y/2;c?f.z+=l.z/2:d.z-=l.z/2;return new za(this.ept,new THREE.Box3(f,d),this.d+1,2*this.x+a,2*this.y+b,2*this.z+c)}children(){for(var a=[],b=0;2>b;++b)for(var c=0;2>c;++c)for(var f=0;2>f;++f){var d=this.step(b,c,f).name();a.includes(d)||(a=a.concat(d))}return a}}class Z extends U{constructor(a,b,c,f,d,l){super();this.ept=a;this.key=
new za(this.ept,b||this.ept.boundingBox,c||0,f,d,l);this.id=Z.IDCount++;this.geometry=null;this.tightBoundingBox=this.boundingBox=this.key.b;this.spacing=this.ept.spacing/Math.pow(2,this.key.d);this.boundingSphere=F.sphereFrom(this.boundingBox);this.hasChildren=!1;this.children={};this.numPoints=-1;this.level=this.key.d;this.loading=this.loaded=!1;this.oneTimeDisposeHandlers=[];a=this.key;this.name=this.toPotreeName(a.d,a.x,a.y,a.z);this.index=parseInt(this.name.charAt(this.name.length-1))}isGeometryNode(){return!0}getLevel(){return this.level}isTreeNode(){return!1}isLoaded(){return this.loaded}getBoundingSphere(){return this.boundingSphere}getBoundingBox(){return this.boundingBox}url(){return this.ept.url+
'ept-data/'+this.filename()}getNumPoints(){return this.numPoints}filename(){return this.key.name()}getChildren(){let a=[];for(let b=0;8>b;b++)this.children[b]&&a.push(this.children[b]);return a}addChild(a){this.children[a.index]=a;a.parent=this}load(){this.loaded||this.loading||w.numNodesLoading>=w.maxNodesLoading||(this.loading=!0,w.numNodesLoading++,-1===this.numPoints&&this.loadHierarchy(),this.loadPoints())}loadPoints(){this.ept.loader.load(this)}loadHierarchy(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let b=
{};b[a.filename()]=a;a.hasChildren=!1;let c=`${a.ept.url}ept-hierarchy/${a.filename()}.json`,f=yield(yield fetch(c)).json();Object.keys(f).sort((a,b)=>{let [c,d,f,l]=a.split('-').map(a=>parseInt(a,10)),[e,g,p,r]=b.split('-').map(a=>parseInt(a,10));return c<e?-1:c>e?1:d<g?-1:d>g?1:f<p?-1:f>p?1:l<r?-1:l>r?1:0}).forEach(c=>{let [d,k,e,h]=c.split('-').map(a=>parseInt(a,10)),m=b[d-1+'-'+(k>>1)+'-'+(e>>1)+'-'+(h>>1)];if(m){m.hasChildren=!0;var g=m.key.step(k&1,e&1,h&1),q=new Z(a.ept,g.b,g.d,g.x,g.y,g.z);
q.level=d;q.numPoints=f[c];m.addChild(q);b[g.name()]=q}})})}doneLoading(a,b,c,f){a.boundingBox=this.boundingBox;this.geometry=a;this.tightBoundingBox=b;this.numPoints=c;this.mean=f;this.loaded=!0;this.loading=!1;w.numNodesLoading--}toPotreeName(a,b,c,f){for(var d='r',l=0;l<a;++l){var k=1<<a-l-1,e=0;b&k&&(e+=4);c&k&&(e+=2);f&k&&(e+=1);d+=e}return d}dispose(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(let a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();
this.oneTimeDisposeHandlers=[]}}}Z.IDCount=0;class Aa{static load(a,b){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var c=yield(yield fetch(a)).json(),f=a.substr(0,a.lastIndexOf('ept.json'));c=new ya(f,c);f=new Z(c);c.root=f;c.root.load();b(c)})}}class L{static generateDataTexture(a,b,c){var f=a*b,d=new Uint8Array(4*a*b),l=Math.floor(255*c.r),k=Math.floor(255*c.g);c=Math.floor(255*c.b);for(var e=0;e<f;e++)d[3*e]=l,d[3*e+1]=k,d[3*e+2]=c;a=new THREE.DataTexture(d,a,b,THREE.RGBAFormat);
a.needsUpdate=!0;a.magFilter=THREE.NearestFilter;return a}static computeTransformedBoundingBox(a,b){a=[(new THREE.Vector3(a.min.x,a.min.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.min.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.min.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.max.y,a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.min.y,a.max.z)).applyMatrix4(b),(new THREE.Vector3(a.min.x,a.max.y,a.max.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.max.y,
a.min.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.min.y,a.max.z)).applyMatrix4(b),(new THREE.Vector3(a.max.x,a.max.y,a.max.z)).applyMatrix4(b)];b=new THREE.Box3;b.setFromPoints(a);return b}}var Ba={RAINBOW:[[0,new THREE.Color(.278,0,.714)],[1/6,new THREE.Color(0,0,1)],[2/6,new THREE.Color(0,1,1)],[.5,new THREE.Color(0,1,0)],[4/6,new THREE.Color(1,1,0)],[5/6,new THREE.Color(1,.64,0)],[1,new THREE.Color(1,0,0)]],SPECTRAL:[[0,new THREE.Color(.3686,.3098,.6353)],[.1,new THREE.Color(.1961,.5333,.7412)],
[.2,new THREE.Color(.4,.7608,.6471)],[.3,new THREE.Color(.6706,.8667,.6431)],[.4,new THREE.Color(.902,.9608,.5961)],[.5,new THREE.Color(1,1,.749)],[.6,new THREE.Color(.9961,.8784,.5451)],[.7,new THREE.Color(.9922,.6824,.3804)],[.8,new THREE.Color(.9569,.4275,.2627)],[.9,new THREE.Color(.8353,.2431,.3098)],[1,new THREE.Color(.6196,.0039,.2588)]],PLASMA:[[0,new THREE.Color(.241,.015,.61)],[.1,new THREE.Color(.387,.001,.654)],[.2,new THREE.Color(.524,.025,.653)],[.3,new THREE.Color(.651,.125,.596)],
[.4,new THREE.Color(.752,.227,.513)],[.5,new THREE.Color(.837,.329,.431)],[.6,new THREE.Color(.907,.435,.353)],[.7,new THREE.Color(.963,.554,.272)],[.8,new THREE.Color(.992,.681,.195)],[.9,new THREE.Color(.987,.822,.144)],[1,new THREE.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new THREE.Color(.1647,.2824,.3451)],[.1,new THREE.Color(.1338,.3555,.4227)],[.2,new THREE.Color(.061,.4319,.4864)],[.3,new THREE.Color(0,.5099,.5319)],[.4,new THREE.Color(0,.5881,.5569)],[.5,new THREE.Color(.137,.665,.5614)],[.6,
new THREE.Color(.2906,.7395,.5477)],[.7,new THREE.Color(.4453,.8099,.5201)],[.8,new THREE.Color(.6102,.8748,.485)],[.9,new THREE.Color(.7883,.9323,.4514)],[1,new THREE.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new THREE.Color(.267,.005,.329)],[.1,new THREE.Color(.283,.141,.458)],[.2,new THREE.Color(.254,.265,.53)],[.3,new THREE.Color(.207,.372,.553)],[.4,new THREE.Color(.164,.471,.558)],[.5,new THREE.Color(.128,.567,.551)],[.6,new THREE.Color(.135,.659,.518)],[.7,new THREE.Color(.267,.749,.441)],[.8,
new THREE.Color(.478,.821,.318)],[.9,new THREE.Color(.741,.873,.15)],[1,new THREE.Color(.993,.906,.144)]],INFERNO:[[0,new THREE.Color(.077,.042,.206)],[.1,new THREE.Color(.225,.036,.388)],[.2,new THREE.Color(.373,.074,.432)],[.3,new THREE.Color(.522,.128,.42)],[.4,new THREE.Color(.665,.182,.37)],[.5,new THREE.Color(.797,.255,.287)],[.6,new THREE.Color(.902,.364,.184)],[.7,new THREE.Color(.969,.516,.063)],[.8,new THREE.Color(.988,.683,.072)],[.9,new THREE.Color(.961,.859,.298)],[1,new THREE.Color(.988,
.998,.645)]],GRAYSCALE:[[0,new THREE.Color(0,0,0)],[1,new THREE.Color(1,1,1)]]},O={};O.vertex='\nprecision highp float;\nprecision highp int;\n\n#define MAX_CLIP_POLYGONS 8\n\n'+THREE.ShaderChunk.common+'\n'+THREE.ShaderChunk.logdepthbuf_pars_vertex+'\n\nattribute vec3 position;\nattribute vec3 color;\nattribute float intensity;\nattribute float classification;\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float pointSourceID;\nattribute vec4 indices;\nattribute float spacing;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 uViewInv;\n\nuniform float uScreenWidth;\nuniform float uScreenHeight;\nuniform float fov;\nuniform float near;\nuniform float far;\n\nuniform bool uDebug;\n\nuniform bool uUseOrthographicCamera;\nuniform float uOrthoWidth;\nuniform float uOrthoHeight;\n\n#define CLIPTASK_NONE 0\n#define CLIPTASK_HIGHLIGHT 1\n#define CLIPTASK_SHOW_INSIDE 2\n#define CLIPTASK_SHOW_OUTSIDE 3\n\n#define CLIPMETHOD_INSIDE_ANY 0\n#define CLIPMETHOD_INSIDE_ALL 1\n\nuniform int clipTask;\nuniform int clipMethod;\n\n#if defined(num_clipboxes)\n#if num_clipboxes > 0\n\tuniform mat4 clipBoxes[num_clipboxes];\n#endif\n#endif\n\n#if defined(num_clipspheres)\n#if num_clipspheres > 0\n\tuniform mat4 uClipSpheres[num_clipspheres];\n#endif\n#endif\n\n#if defined(num_clippolygons)\n#if num_clippolygons > 0\n\tuniform int uClipPolygonVCount[num_clippolygons];\n\tuniform vec3 uClipPolygonVertices[num_clippolygons * 8];\n\tuniform mat4 uClipPolygonWVP[num_clippolygons];\n#endif\n#endif\n\nuniform float size;\nuniform float minSize;\nuniform float maxSize;\n\nuniform float uPCIndex;\nuniform float uOctreeSpacing;\nuniform float uNodeSpacing;\nuniform float uOctreeSize;\nuniform vec3 uBBSize;\nuniform float uLevel;\nuniform float uVNStart;\nuniform bool uIsLeafNode;\n\nuniform vec3 uColor;\nuniform float uOpacity;\n\nuniform vec2 elevationRange;\nuniform vec2 intensityRange;\nuniform float intensityGamma;\nuniform float intensityContrast;\nuniform float intensityBrightness;\nuniform float rgbGamma;\nuniform float rgbContrast;\nuniform float rgbBrightness;\nuniform float uTransition;\nuniform float wRGB;\nuniform float wIntensity;\nuniform float wElevation;\nuniform float wClassification;\nuniform float wReturnNumber;\nuniform float wSourceID;\n\nuniform vec3 uShadowColor;\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\n\n#if defined(num_shadowmaps)\n#if num_shadowmaps > 0\n\tuniform sampler2D uShadowMap[num_shadowmaps];\n\tuniform mat4 uShadowWorldView[num_shadowmaps];\n\tuniform mat4 uShadowProj[num_shadowmaps];\n#endif\n#endif\n\nvarying vec3 vColor;\nvarying float vLogDepth;\nvarying vec3 vViewPosition;\nvarying float vRadius;\nvarying float vPointSize;\n\nfloat round(float number)\n{\n\treturn floor(number + 0.5);\n}\n\n//---------------------\n//OCTREE\n//---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_lod))\n#if defined(tree_type_octree)\n\n\t/**\n\t * number of 1-bits up to inclusive index position\n\t * number is treated as if it were an integer in the range 0-255\n\t */\n\tint numberOfOnes(int number, int index)\n\t{\n\t\tint numOnes = 0;\n\t\tint tmp = 128;\n\n\t\tfor(int i = 7; i >= 0; i--)\n\t\t{\n\t\t\tif(number >= tmp)\n\t\t\t{\n\t\t\t\tnumber = number - tmp;\n\n\t\t\t\tif(i <= index)\n\t\t\t\t{\n\t\t\t\t\tnumOnes++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\ttmp = tmp / 2;\n\t\t}\n\n\t\treturn numOnes;\n\t}\n\n\t/**\n\t * checks whether the bit at index is 1\n\t * number is treated as if it were an integer in the range 0-255\n\t */\n\tbool isBitSet(int number, int index)\n\t{\n\t\t//weird multi else if due to lack of proper array, int and bitwise support in WebGL 1.0\n\t\tint powi = 1;\n\n\t\tif(index == 0)\n\t\t{\n\t\t\tpowi = 1;\n\t\t}\n\t\telse if(index == 1)\n\t\t{\n\t\t\tpowi = 2;\n\t\t}\n\t\telse if(index == 2)\n\t\t{\n\t\t\tpowi = 4;\n\t\t}\n\t\telse if(index == 3)\n\t\t{\n\t\t\tpowi = 8;\n\t\t}\n\t\telse if(index == 4)\n\t\t{\n\t\t\tpowi = 16;\n\t\t}\n\t\telse if(index == 5)\n\t\t{\n\t\t\tpowi = 32;\n\t\t}\n\t\telse if(index == 6)\n\t\t{\n\t\t\tpowi = 64;\n\t\t}\n\t\telse if(index == 7)\n\t\t{\n\t\t\tpowi = 128;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tint ndp = number / powi;\n\n\t\treturn mod(float(ndp), 2.0) != 0.0;\n\t}\n\n\t/**\n\t * find the LOD at the point position\n\t */\n\tfloat getLOD()\n\t{\n\t\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\t\tint iOffset = int(uVNStart);\n\t\tfloat depth = uLevel;\n\n\t\tfor(float i = 0.0; i <= 30.0; i++)\n\t\t{\n\t\t\tfloat nodeSizeAtLevel = uOctreeSize / pow(2.0, i + uLevel + 0.0);\n\t\t\t\n\t\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\t\tindex3d = floor(index3d + 0.5);\n\t\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\t\n\t\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\t\tint mask = int(round(value.r * 255.0));\n\n\t\t\tif(isBitSet(mask, index))\n\t\t\t{\n\t\t\t\t//there are more visible child nodes at this position\n\t\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\t\tiOffset = iOffset + advance;\n\t\t\t\t\n\t\t\t\tdepth++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//no more visible child nodes at this position\n\t\t\t\treturn value.a * 255.0;\n\t\t\t\t//return depth;\n\t\t\t}\n\t\t\t\n\t\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t\t}\n\t\t\t\n\t\treturn depth;\n\t}\n\n\tfloat getSpacing()\n\t{\n\t\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\t\tint iOffset = int(uVNStart);\n\t\tfloat depth = uLevel;\n\t\tfloat spacing = uNodeSpacing;\n\n\t\tfor(float i = 0.0; i <= 30.0; i++)\n\t\t{\n\t\t\tfloat nodeSizeAtLevel = uOctreeSize / pow(2.0, i + uLevel + 0.0);\n\t\t\t\n\t\t\tvec3 index3d = (position-offset) / nodeSizeAtLevel;\n\t\t\tindex3d = floor(index3d + 0.5);\n\t\t\tint index = int(round(4.0 * index3d.x + 2.0 * index3d.y + index3d.z));\n\t\t\t\n\t\t\tvec4 value = texture2D(visibleNodes, vec2(float(iOffset) / 2048.0, 0.0));\n\t\t\tint mask = int(round(value.r * 255.0));\n\t\t\tfloat spacingFactor = value.a;\n\n\t\t\tif(i > 0.0)\n\t\t\t{\n\t\t\t\tspacing = spacing / (255.0 * spacingFactor);\n\t\t\t}\n\t\t\t\n\t\t\tif(isBitSet(mask, index))\n\t\t\t{\n\t\t\t\t//there are more visible child nodes at this position\n\t\t\t\tint advanceG = int(round(value.g * 255.0)) * 256;\n\t\t\t\tint advanceB = int(round(value.b * 255.0));\n\t\t\t\tint advanceChild = numberOfOnes(mask, index - 1);\n\t\t\t\tint advance = advanceG + advanceB + advanceChild;\n\n\t\t\t\tiOffset = iOffset + advance;\n\n\t\t\t\tdepth++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t//no more visible child nodes at this position\n\t\t\t\treturn spacing;\n\t\t\t}\n\t\t\t\n\t\t\toffset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n\t\t}\n\t\t\t\n\t\treturn spacing;\n\t}\n\n\tfloat getPointSizeAttenuation()\n\t{\n\t\treturn pow(2.0, getLOD());\n\t}\n#endif\n#endif\n\n//---------------------\n//KD-TREE\n//---------------------\n#if (defined(adaptive_point_size) || defined(color_type_lod))\n#if defined(tree_type_kdtree)\n\tfloat getLOD()\n\t{\n\t\tvec3 offset = vec3(0.0, 0.0, 0.0);\n\t\tfloat iOffset = 0.0;\n\t\tfloat depth = 0.0;\n\t\t\t\n\t\tvec3 size = uBBSize;\t\n\t\tvec3 pos = position;\n\t\t\t\n\t\tfor(float i = 0.0; i <= 1000.0; i++)\n\t\t{\n\t\t\tvec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\t\t\t\n\t\t\tint children = int(value.r * 255.0);\n\t\t\tfloat next = value.g * 255.0;\n\t\t\tint split = int(value.b * 255.0);\n\t\t\t\n\t\t\tif(next == 0.0)\n\t\t\t{\n\t\t\t \treturn depth;\n\t\t\t}\n\t\t\t\n\t\t\tvec3 splitv = vec3(0.0, 0.0, 0.0);\n\t\t\tif(split == 1)\n\t\t\t{\n\t\t\t\tsplitv.x = 1.0;\n\t\t\t}\n\t\t\telse if(split == 2)\n\t\t\t{\n\t\t\t \tsplitv.y = 1.0;\n\t\t\t}\n\t\t\telse if(split == 4)\n\t\t\t{\n\t\t\t \tsplitv.z = 1.0;\n\t\t\t}\n\t\t\t\n\t\t\tiOffset = iOffset + next;\n\t\t\t\n\t\t\tfloat factor = length(pos * splitv / size);\n\n\t\t\t//Left\n\t\t\tif(factor < 0.5)\n\t\t\t{\n\t\t\t\tif(children == 0 || children == 2)\n\t\t\t\t{\n\t\t\t\t\treturn depth;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//Right\n\t\t\telse\n\t\t\t{\n\t\t\t\tpos = pos - size * splitv * 0.5;\n\t\t\t\tif(children == 0 || children == 1)\n\t\t\t\t{\n\t\t\t\t\treturn depth;\n\t\t\t\t}\n\t\t\t\tif(children == 3)\n\t\t\t\t{\n\t\t\t\t\tiOffset = iOffset + 1.0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsize = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\t\t\tdepth++;\n\t\t}\n\t\t\t\n\t\treturn depth;\t\n\t}\n\n\tfloat getPointSizeAttenuation()\n\t{\n\t\treturn 0.5 * pow(1.3, getLOD());\n\t}\n#endif\n#endif\n\n//formula adapted from: http://www.dfstudios.co.uk/articles/programming/image-programming-algorithms/image-processing-algorithms-part-5-contrast-adjustment/\nfloat getContrastFactor(float contrast)\n{\n\treturn (1.0158730158730156 * (contrast + 1.0)) / (1.0158730158730156 - contrast);\n}\n\nvec3 getRGB()\n{\n\tvec3 rgb = color;\n\t\n\trgb = pow(rgb, vec3(rgbGamma));\n\trgb = rgb + rgbBrightness;\n\trgb = clamp(rgb, 0.0, 1.0);\n\t\n\treturn rgb;\n}\n\nfloat getIntensity()\n{\n\tfloat w = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n\tw = pow(w, intensityGamma);\n\tw = w + intensityBrightness;\n\tw = (w - 0.5) * getContrastFactor(intensityContrast) + 0.5;\n\tw = clamp(w, 0.0, 1.0);\n\n\treturn w;\n}\n\nvec3 getElevation()\n{\n\tvec4 world = modelMatrix * vec4( position, 1.0 );\n\tfloat w = (world.z - elevationRange.x) / (elevationRange.y - elevationRange.x);\n\treturn texture2D(gradient, vec2(w,1.0-w)).rgb;\n}\n\nvec4 getClassification()\n{\n\tvec2 uv = vec2(classification / 255.0, 0.5);\n\treturn texture2D(classificationLUT, uv);\n}\n\nvec3 getReturnNumber()\n{\n\tif(numberOfReturns == 1.0)\n\t{\n\t\treturn vec3(1.0, 1.0, 0.0);\n\t}\n\telse\n\t{\n\t\tif(returnNumber == 1.0)\n\t\t{\n\t\t\treturn vec3(1.0, 0.0, 0.0);\n\t\t}\n\t\telse if(returnNumber == numberOfReturns)\n\t\t{\n\t\t\treturn vec3(0.0, 0.0, 1.0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn vec3(0.0, 1.0, 0.0);\n\t\t}\n\t}\n}\n\nvec3 getSourceID()\n{\n\tfloat w = mod(pointSourceID, 10.0) / 10.0;\n\treturn texture2D(gradient, vec2(w,1.0 - w)).rgb;\n}\n\nvec3 getCompositeColor()\n{\n\tvec3 c;\n\tfloat w;\n\n\tc += wRGB * getRGB();\n\tw += wRGB;\n\t\n\tc += wIntensity * getIntensity() * vec3(1.0, 1.0, 1.0);\n\tw += wIntensity;\n\t\n\tc += wElevation * getElevation();\n\tw += wElevation;\n\t\n\tc += wReturnNumber * getReturnNumber();\n\tw += wReturnNumber;\n\t\n\tc += wSourceID * getSourceID();\n\tw += wSourceID;\n\t\n\tvec4 cl = wClassification * getClassification();\n    c += cl.a * cl.rgb;\n\tw += wClassification * cl.a;\n\n\tc = c / w;\n\t\n\tif(w == 0.0)\n\t{\n\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t}\n\t\n\treturn c;\n}\n\nvec3 getColor()\n{\n\tvec3 color;\n\t\n\t#ifdef color_type_rgb\n\t\tcolor = getRGB();\n\t#elif defined color_type_height\n\t\tcolor = getElevation();\n\t#elif defined color_type_rgb_height\n\t\tvec3 cHeight = getElevation();\n\t\tcolor = (1.0 - uTransition) * getRGB() + uTransition * cHeight;\n\t#elif defined color_type_depth\n\t\tfloat linearDepth = gl_Position.w;\n\t\tfloat expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n\t\tcolor = vec3(linearDepth, expDepth, 0.0);\n\t#elif defined color_type_intensity\n\t\tfloat w = getIntensity();\n\t\tcolor = vec3(w, w, w);\n\t#elif defined color_type_intensity_gradient\n\t\tfloat w = getIntensity();\n\t\tcolor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_color\n\t\tcolor = uColor;\n\t#elif defined color_type_lod\n\t\tfloat depth = getLOD();\n\t\tfloat w = depth / 10.0;\n\t\tcolor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n\t#elif defined color_type_point_index\n\t\tcolor = indices.rgb;\n\t#elif defined color_type_classification\n\t\tvec4 cl = getClassification(); \n\t\tcolor = cl.rgb;\n\t#elif defined color_type_return_number\n\t\tcolor = getReturnNumber();\n\t#elif defined color_type_source\n\t\tcolor = getSourceID();\n\t#elif defined color_type_normal\n\t\tcolor = (modelMatrix * vec4(normal, 0.0)).xyz;\n\t#elif defined color_type_phong\n\t\tcolor = color;\n\t#elif defined color_type_composite\n\t\tcolor = getCompositeColor();\n\t#endif\n\t\n\treturn color;\n}\n\nfloat getPointSize()\n{\n\tfloat pointSize = 1.0;\n\t\n\tfloat slope = tan(fov / 2.0);\n\tfloat projFactor = -0.5 * uScreenHeight / (slope * vViewPosition.z);\n\t\n\tfloat r = uOctreeSpacing * 1.7;\n\tvRadius = r;\n\n\t#if defined fixed_point_size\n\t\tpointSize = size;\n\t#elif defined attenuated_point_size\n\t\tif(uUseOrthographicCamera)\n\t\t{\n\t\t\tpointSize = size;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpointSize = size * spacing * projFactor;\n\t\t}\n\t#elif defined adaptive_point_size\n\t\tif(uUseOrthographicCamera)\n\t\t{\n\t\t\tfloat worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();\n\t\t\tpointSize = (worldSpaceSize / uOrthoWidth) * uScreenWidth;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(uIsLeafNode && false)\n\t\t\t{\n\t\t\t\tpointSize = size * spacing * projFactor;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfloat worldSpaceSize = 1.0 * size * r / getPointSizeAttenuation();\n\t\t\t\tpointSize = worldSpaceSize * projFactor;\n\t\t\t}\n\t\t}\n\t#endif\n\n\tpointSize = max(minSize, pointSize);\n\tpointSize = min(maxSize, pointSize);\n\t\n\tvRadius = pointSize / projFactor;\n\n\treturn pointSize;\n}\n\n#if defined num_clippolygons\n#if num_clippolygons > 0\n\tbool pointInClipPolygon(vec3 point, int polyIdx)\n\t{\n\t\tmat4 wvp = uClipPolygonWVP[polyIdx];\n\n\t\tvec4 pointNDC = wvp * vec4(point, 1.0);\n\t\tpointNDC.xy = pointNDC.xy / pointNDC.w;\n\n\t\tint j = uClipPolygonVCount[polyIdx] - 1;\n\t\tbool c = false;\n\t\tfor(int i = 0; i < 8; i++)\n\t\t{\n\t\t\tif(i == uClipPolygonVCount[polyIdx])\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvec3 verti = uClipPolygonVertices[polyIdx * 8 + i];\n\t\t\tvec3 vertj = uClipPolygonVertices[polyIdx * 8 + j];\n\n\t\t\tif(((verti.y > pointNDC.y) != (vertj.y > pointNDC.y)) && (pointNDC.x < (vertj.x-verti.x) * (pointNDC.y-verti.y) / (vertj.y-verti.y) + verti.x))\n\t\t\t{\n\t\t\t\tc = !c;\n\t\t\t}\n\n\t\t\tj = i;\n\t\t}\n\n\t\treturn c;\n\t}\n#endif\n#endif\n\nvoid doClipping()\n{\n\t#if !defined color_type_composite\n\t\tvec4 cl = getClassification(); \n\t\tif(cl.a == 0.0)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t#endif\n\n\tint clipVolumesCount = 0;\n\tint insideCount = 0;\n\n\t#if defined(num_clipboxes)\n\t#if num_clipboxes > 0\n\t\tfor(int i = 0; i < num_clipboxes; i++)\n\t\t{\n\t\t\tvec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );\n\t\t\tbool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n\t\t\tinside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n\n\t\t\tinsideCount = insideCount + (inside ? 1 : 0);\n\t\t\tclipVolumesCount++;\n\t\t}\t\n\t#endif\n\t#endif\n\n\t#if defined(num_clippolygons)\n\t#if num_clippolygons > 0\n\t\tfor(int i = 0; i < num_clippolygons; i++)\n\t\t{\n\t\t\tbool inside = pointInClipPolygon(position, i);\n\n\t\t\tinsideCount = insideCount + (inside ? 1 : 0);\n\t\t\tclipVolumesCount++;\n\t\t}\n\t#endif\n\t#endif\n\n\tbool insideAny = insideCount > 0;\n\tbool insideAll = (clipVolumesCount > 0) && (clipVolumesCount == insideCount);\n\n\tif(clipMethod == CLIPMETHOD_INSIDE_ANY)\n\t{\n\t\tif(insideAny && clipTask == CLIPTASK_HIGHLIGHT)\n\t\t{\n\t\t\tvColor.r += 0.5;\n\t\t}\n\t\telse if(!insideAny && clipTask == CLIPTASK_SHOW_INSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t\telse if(insideAny && clipTask == CLIPTASK_SHOW_OUTSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t}\n\telse if(clipMethod == CLIPMETHOD_INSIDE_ALL)\n\t{\n\t\tif(insideAll && clipTask == CLIPTASK_HIGHLIGHT)\n\t\t{\n\t\t\tvColor.r += 0.5;\n\t\t}\n\t\telse if(!insideAll && clipTask == CLIPTASK_SHOW_INSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t\telse if(insideAll && clipTask == CLIPTASK_SHOW_OUTSIDE)\n\t\t{\n\t\t\tgl_Position = vec4(100.0, 100.0, 100.0, 1.0);\n\t\t}\n\t}\n}\n\nvoid main()\n{\n\tvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n\tvViewPosition = mvPosition.xyz;\n\tgl_Position = projectionMatrix * mvPosition;\n\n\tvLogDepth = log2(-mvPosition.z);\n\n\t//POINT SIZE\n\tfloat pointSize = getPointSize();\n\tgl_PointSize = pointSize;\n\tvPointSize = pointSize;\n\n\t'+
THREE.ShaderChunk.logdepthbuf_vertex+'\n\n\t//COLOR\n\tvColor = getColor();\n\n\t#if defined hq_depth_pass\n\t\tfloat originalDepth = gl_Position.w;\n\t\tfloat adjustedDepth = originalDepth + 2.0 * vRadius;\n\t\tfloat adjust = adjustedDepth / originalDepth;\n\n\t\tmvPosition.xyz = mvPosition.xyz * adjust;\n\t\tgl_Position = projectionMatrix * mvPosition;\n\t#endif\n\n\t//CLIPPING\n\tdoClipping();\n\n\t#if defined num_clipspheres\n\t#if num_clipspheres > 0\n\t\tfor(int i = 0; i < num_clipspheres; i++)\n\t\t{\n\t\t\tvec4 sphereLocal = uClipSpheres[i] * mvPosition;\n\n\t\t\tfloat distance = length(sphereLocal.xyz);\n\n\t\t\tif(distance < 1.0)\n\t\t\t{\n\t\t\t\tfloat w = distance;\n\t\t\t\tvec3 cGradient = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n\t\t\t\t\n\t\t\t\tvColor = cGradient;\n\t\t\t}\n\t\t}\n\t#endif\n\t#endif\n\n\t#if defined num_shadowmaps\n\t#if num_shadowmaps > 0\n\n\t\tconst float sm_near = 0.1;\n\t\tconst float sm_far = 10000.0;\n\n\t\tfor(int i = 0; i < num_shadowmaps; i++)\n\t\t{\n\t\t\tvec3 viewPos = (uShadowWorldView[i] * vec4(position, 1.0)).xyz;\n\t\t\tfloat distanceToLight = abs(viewPos.z);\n\t\t\t\n\t\t\tvec4 projPos = uShadowProj[i] * uShadowWorldView[i] * vec4(position, 1);\n\t\t\tvec3 nc = projPos.xyz / projPos.w;\n\t\t\t\n\t\t\tfloat u = nc.x * 0.5 + 0.5;\n\t\t\tfloat v = nc.y * 0.5 + 0.5;\n\n\t\t\tvec2 sampleStep = vec2(1.0 / (2.0*1024.0), 1.0 / (2.0*1024.0)) * 1.5;\n\t\t\tvec2 sampleLocations[9];\n\n\t\t\tsampleLocations[0] = vec2(0.0, 0.0);\n\t\t\tsampleLocations[1] = sampleStep;\n\t\t\tsampleLocations[2] = -sampleStep;\n\t\t\tsampleLocations[3] = vec2(sampleStep.x, -sampleStep.y);\n\t\t\tsampleLocations[4] = vec2(-sampleStep.x, sampleStep.y);\n\t\t\tsampleLocations[5] = vec2(0.0, sampleStep.y);\n\t\t\tsampleLocations[6] = vec2(0.0, -sampleStep.y);\n\t\t\tsampleLocations[7] = vec2(sampleStep.x, 0.0);\n\t\t\tsampleLocations[8] = vec2(-sampleStep.x, 0.0);\n\n\t\t\tfloat visibleSamples = 0.0;\n\t\t\tfloat numSamples = 0.0;\n\n\t\t\tfloat bias = vRadius * 2.0;\n\n\t\t\tfor(int j = 0; j < 9; j++)\n\t\t\t{\n\t\t\t\tvec4 depthMapValue = texture2D(uShadowMap[i], vec2(u, v) + sampleLocations[j]);\n\n\t\t\t\tfloat linearDepthFromSM = depthMapValue.x + bias;\n\t\t\t\tfloat linearDepthFromViewer = distanceToLight;\n\n\t\t\t\tif(linearDepthFromSM > linearDepthFromViewer)\n\t\t\t\t{\n\t\t\t\t\tvisibleSamples += 1.0;\n\t\t\t\t}\n\n\t\t\t\tnumSamples += 1.0;\n\t\t\t}\n\n\t\t\tfloat visibility = visibleSamples / numSamples;\n\n\t\t\tif(u < 0.0 || u > 1.0 || v < 0.0 || v > 1.0 || nc.x < -1.0 || nc.x > 1.0 || nc.y < -1.0 || nc.y > 1.0 || nc.z < -1.0 || nc.z > 1.0)\n\t\t\t{\n\t\t\t\t//vColor = vec3(0.0, 0.0, 0.2);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvColor = vColor * visibility + vColor * uShadowColor * (1.0 - visibility);\n\t\t\t}\n\t\t}\n\n\t#endif\n\t#endif\n}';
O.fragment='\n\n#if defined USE_LOGDEPTHBUF_EXT || defined paraboloid_point_shape\n\t#extension GL_EXT_frag_depth : enable\n#endif\n\nprecision highp float;\nprecision highp int;\n\n'+THREE.ShaderChunk.common+'\n'+THREE.ShaderChunk.logdepthbuf_pars_fragment+'\n\nuniform mat4 viewMatrix;\nuniform mat4 uViewInv;\nuniform mat4 uProjInv;\nuniform vec3 cameraPosition;\n\nuniform mat4 projectionMatrix;\nuniform float uOpacity;\n\nuniform float blendHardness;\nuniform float blendDepthSupplement;\nuniform float fov;\nuniform float uSpacing;\nuniform float near;\nuniform float far;\nuniform float uPCIndex;\nuniform float uScreenWidth;\nuniform float uScreenHeight;\n\nvarying vec3 vColor;\nvarying float vLogDepth;\nvarying vec3 vViewPosition;\nvarying float vRadius;\nvarying float vPointSize;\nvarying vec3 vPosition;\n\nvoid main()\n{\n\tvec3 color = vColor;\n\tfloat depth = gl_FragCoord.z;\n\n\t#if defined circle_point_shape || defined paraboloid_point_shape\n\t\tfloat u = (2.0 * gl_PointCoord.x) - 1.0;\n\t\tfloat v = (2.0 * gl_PointCoord.y) - 1.0;\n\t#endif\n\t\n\t#if defined circle_point_shape\n\t\tfloat cc = (u*u) + (v*v);\n\t\tif(cc > 1.0)\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n\n\t#if defined color_type_point_index\n\t\tgl_FragColor = vec4(color, uPCIndex / 255.0);\n\t#else\n\t\tgl_FragColor = vec4(color, uOpacity);\n\t#endif\n\n\t#if defined paraboloid_point_shape\n\t\tfloat wi = -( u*u + v*v);\n\t\tvec4 pos = vec4(vViewPosition, 1.0);\n\t\tpos.z += wi * vRadius;\n\t\tfloat linearDepth = -pos.z;\n\t\tpos = projectionMatrix * pos;\n\t\tpos = pos / pos.w;\n\t\tfloat expDepth = pos.z;\n\t\tdepth = (pos.z + 1.0) / 2.0;\n\n\t\tgl_FragDepthEXT = depth;\n\t\t\n\t\t#if defined color_type_depth\n\t\t\tcolor.r = linearDepth;\n\t\t\tcolor.g = expDepth;\n\t\t#endif\n\t#endif\n\t\n\t'+
THREE.ShaderChunk.logdepthbuf_fragment+'\n\n\t#if defined weighted_splats\n\t\tfloat distance = 2.0 * length(gl_PointCoord.xy - 0.5);\n\t\tfloat weight = max(0.0, 1.0 - distance);\n\t\tweight = pow(weight, 1.5);\n\n\t\tgl_FragColor.a = weight;\n\t\tgl_FragColor.xyz = gl_FragColor.xyz * weight;\n\t#endif\n}';class M extends THREE.RawShaderMaterial{constructor(a={}){super();this.visibleNodesTexture=L.generateDataTexture(2048,1,new THREE.Color(16777215));this.visibleNodesTexture.minFilter=THREE.NearestFilter;
this.visibleNodesTexture.magFilter=THREE.NearestFilter;var b=function(a,b){return void 0!==a?a:b},c=b(a.size,1),f=b(a.minSize,2),d=b(a.maxSize,50);a=b(a.treeType,V.OCTREE);this._pointSizeType=P.FIXED;this._shape=W.SQUARE;this._pointColorType=B.RGB;this._weighted=this._useClipBox=!1;this._gradient=Ba.SPECTRAL;this._treeType=a;this._snapEnabled=this._useEDL=!1;this._numSnapshots=0;this._defaultElevationRangeChanged=this._defaultIntensityRangeChanged=!1;this.clipBoxes=[];this.clipPolygons=[];this.gradientTexture=
M.generateGradientTexture(this._gradient);this.fog=this.lights=!1;this.defines=new Map;this.attributes={position:{type:'fv',value:[]},color:{type:'fv',value:[]},normal:{type:'fv',value:[]},intensity:{type:'f',value:[]},classification:{type:'f',value:[]},returnNumber:{type:'f',value:[]},numberOfReturns:{type:'f',value:[]},pointSourceID:{type:'f',value:[]},indices:{type:'fv',value:[]}};this.uniforms={level:{type:'f',value:0},vnStart:{type:'f',value:0},spacing:{type:'f',value:1},blendHardness:{type:'f',
value:2},blendDepthSupplement:{type:'f',value:0},fov:{type:'f',value:1},screenWidth:{type:'f',value:1},screenHeight:{type:'f',value:1},near:{type:'f',value:.1},far:{type:'f',value:1},uColor:{type:'c',value:new THREE.Color(16777215)},uOpacity:{type:'f',value:1},size:{type:'f',value:c},minSize:{type:'f',value:f},maxSize:{type:'f',value:d},octreeSize:{type:'f',value:0},bbSize:{type:'fv',value:[0,0,0]},elevationRange:{type:'2fv',value:[0,0]},clipBoxCount:{type:'f',value:0},clipPolygonCount:{type:'i',
value:0},clipBoxes:{type:'Matrix4fv',value:[]},clipPolygons:{type:'3fv',value:[]},clipPolygonVCount:{type:'iv',value:[]},clipPolygonVP:{type:'Matrix4fv',value:[]},visibleNodes:{type:'t',value:this.visibleNodesTexture},pcIndex:{type:'f',value:0},gradient:{type:'t',value:this.gradientTexture},classificationLUT:{type:'t',value:this.classificationTexture},uHQDepthMap:{type:'t',value:null},toModel:{type:'Matrix4f',value:[]},diffuse:{type:'fv',value:[1,1,1]},transition:{type:'f',value:.5},intensityRange:{type:'fv',
value:[0,65E3]},intensityGamma:{type:'f',value:1},intensityContrast:{type:'f',value:0},intensityBrightness:{type:'f',value:0},rgbGamma:{type:'f',value:1},rgbContrast:{type:'f',value:0},rgbBrightness:{type:'f',value:0},wRGB:{type:'f',value:1},wIntensity:{type:'f',value:0},wElevation:{type:'f',value:0},wClassification:{type:'f',value:0},wReturnNumber:{type:'f',value:0},wSourceID:{type:'f',value:0},useOrthographicCamera:{type:'b',value:!1},clipTask:{type:'i',value:1},clipMethod:{type:'i',value:1},uSnapshot:{type:'tv',
value:[]},uSnapshotDepth:{type:'tv',value:[]},uSnapView:{type:'Matrix4fv',value:[]},uSnapProj:{type:'Matrix4fv',value:[]},uSnapProjInv:{type:'Matrix4fv',value:[]},uSnapViewInv:{type:'Matrix4fv',value:[]},uShadowColor:{type:'3fv',value:[0,0,0]},uFilterReturnNumberRange:{type:'fv',value:[0,7]},uFilterNumberOfReturnsRange:{type:'fv',value:[0,7]},uFilterGPSTimeClipRange:{type:'fv',value:[0,7]}};this.classification=Ca.DEFAULT;this.defaultAttributeValues.normal=[0,0,0];this.defaultAttributeValues.classification=
[0,0,0];this.defaultAttributeValues.indices=[0,0,0,0];c=this.getDefines();this.vertexShader=c+O.vertex;this.fragmentShader=c+O.fragment;this.vertexColors=THREE.VertexColors}setDefine(a,b){void 0!==b&&null!==b?this.defines.get(a)!==b&&(this.defines.set(a,b),this.updateShaderSource()):this.removeDefine(a)}removeDefine(a){this.defines.delete(a)}updateShaderSource(){var a=this.getDefines();this.vertexShader=a+O.vertex;this.fragmentShader=a+O.fragment;1===this.opacity?(this.blending=THREE.NoBlending,this.transparent=
!1,this.depthWrite=this.depthTest=!0,this.depthFunc=THREE.LessEqualDepth):1>this.opacity&&!this.useEDL&&(this.blending=THREE.NormalBlending,this.depthWrite=this.depthTest=this.transparent=!0,this.depthFunc=THREE.LessEqualDepth);this.weighted&&(this.blending=THREE.AdditiveBlending,this.depthTest=this.transparent=!0,this.depthWrite=!1);this.needsUpdate=!0}onBeforeCompile(a,b){b.capabilities.logarithmicDepthBuffer&&(a.fragmentShader='#define USE_LOGDEPTHBUF\n#define USE_LOGDEPTHBUF_EXT\n#define EPSILON 1e-6\n'+
a.fragmentShader,a.vertexShader='#define USE_LOGDEPTHBUF\n#define USE_LOGDEPTHBUF_EXT\n#define EPSILON 1e-6\n'+a.vertexShader)}getDefines(){var a=[];this.pointSizeType===P.FIXED?a.push('#define fixed_point_size'):this.pointSizeType===P.ATTENUATED?a.push('#define attenuated_point_size'):this.pointSizeType===P.ADAPTIVE&&a.push('#define adaptive_point_size');this.shape===W.SQUARE?a.push('#define square_point_shape'):this.shape===W.CIRCLE?a.push('#define circle_point_shape'):this.shape===W.PARABOLOID&&
a.push('#define paraboloid_point_shape');this._useEDL&&a.push('#define use_edl');this._snapEnabled&&a.push('#define snap_enabled');this._pointColorType===B.RGB?a.push('#define color_type_rgb'):this._pointColorType===B.COLOR?a.push('#define color_type_color'):this._pointColorType===B.DEPTH?a.push('#define color_type_depth'):this._pointColorType===B.HEIGHT?a.push('#define color_type_height'):this._pointColorType===B.INTENSITY?a.push('#define color_type_intensity'):this._pointColorType===B.INTENSITY_GRADIENT?
a.push('#define color_type_intensity_gradient'):this._pointColorType===B.LOD?a.push('#define color_type_lod'):this._pointColorType===B.POINT_INDEX?a.push('#define color_type_point_index'):this._pointColorType===B.CLASSIFICATION?a.push('#define color_type_classification'):this._pointColorType===B.RETURN_NUMBER?a.push('#define color_type_return_number'):this._pointColorType===B.SOURCE?a.push('#define color_type_source'):this._pointColorType===B.NORMAL?a.push('#define color_type_normal'):this._pointColorType===
B.PHONG?a.push('#define color_type_phong'):this._pointColorType===B.RGB_HEIGHT?a.push('#define color_type_rgb_height'):this._pointColorType===B.COMPOSITE&&a.push('#define color_type_composite');this._treeType===V.OCTREE?a.push('#define tree_type_octree'):this._treeType===V.KDTREE&&a.push('#define tree_type_kdtree');this.weighted&&a.push('#define weighted_splats');var b;for([,b]of this.defines)a.push(b);return a.join('\n')}setClipBoxes(a){if(a){var b=this.clipBoxes.length!==a.length&&(0===a.length||
0===this.clipBoxes.length);this.uniforms.clipBoxCount.value=this.clipBoxes.length;this.clipBoxes=a;b&&this.updateShaderSource();this.uniforms.clipBoxes.value=new Float32Array(16*this.clipBoxes.length);for(b=0;b<this.clipBoxes.length;b++)this.uniforms.clipBoxes.value.set(a[b].inverse.elements,16*b);for(b=0;b<this.uniforms.clipBoxes.value.length;b++)Number.isNaN(this.uniforms.clipBoxes.value[b])&&(this.uniforms.clipBoxes.value[b]=Infinity)}}setClipPolygons(a,b){a&&(this.clipPolygons=a,this.clipPolygons.length!==
a.length&&this.updateShaderSource())}get gradient(){return this._gradient}set gradient(a){this._gradient!==a&&(this._gradient=a,this.gradientTexture=M.generateGradientTexture(this._gradient),this.uniforms.gradient.value=this.gradientTexture)}get useOrthographicCamera(){return this.uniforms.useOrthographicCamera.value}set useOrthographicCamera(a){this.uniforms.useOrthographicCamera.value!==a&&(this.uniforms.useOrthographicCamera.value=a)}get classification(){return this._classification}set classification(a){var b=
{},c;for(c of Object.keys(a))b[c]=a[c].clone();if(void 0===this._classification)a=!1;else{a=Object.keys(b).length===Object.keys(this._classification).length;for(c of Object.keys(b))a=(a=a&&void 0!==this._classification[c])&&b[c].equals(this._classification[c])}a||(this._classification=b,this.recomputeClassification())}recomputeClassification(){this.classificationTexture=M.generateClassificationTexture(this._classification);this.uniforms.classificationLUT.value=this.classificationTexture;this.dispatchEvent({type:'material_property_changed',
target:this})}get numSnapshots(){return this._numSnapshots}set numSnapshots(a){this._numSnapshots=a}get snapEnabled(){return this._snapEnabled}set snapEnabled(a){this._snapEnabled!==a&&(this._snapEnabled=a,this.updateShaderSource())}get spacing(){return this.uniforms.spacing.value}set spacing(a){this.uniforms.spacing.value!==a&&(this.uniforms.spacing.value=a)}get useClipBox(){return this._useClipBox}set useClipBox(a){this._useClipBox!==a&&(this._useClipBox=a,this.updateShaderSource())}get clipTask(){return this.uniforms.clipTask.value}set clipTask(a){this.uniforms.clipTask.value=
a}get clipMethod(){return this.uniforms.clipMethod.value}set clipMethod(a){this.uniforms.clipMethod.value=a}get weighted(){return this._weighted}set weighted(a){this._weighted!==a&&(this._weighted=a,this.updateShaderSource())}get fov(){return this.uniforms.fov.value}set fov(a){this.uniforms.fov.value!==a&&(this.uniforms.fov.value=a,this.updateShaderSource())}get screenWidth(){return this.uniforms.screenWidth.value}set screenWidth(a){this.uniforms.screenWidth.value!==a&&(this.uniforms.screenWidth.value=
a,this.updateShaderSource())}get screenHeight(){return this.uniforms.screenHeight.value}set screenHeight(a){this.uniforms.screenHeight.value!==a&&(this.uniforms.screenHeight.value=a,this.updateShaderSource())}get near(){return this.uniforms.near.value}set near(a){this.uniforms.near.value!==a&&(this.uniforms.near.value=a)}get far(){return this.uniforms.far.value}set far(a){this.uniforms.far.value!==a&&(this.uniforms.far.value=a)}get opacity(){return this.uniforms.uOpacity.value}set opacity(a){this.uniforms&&
this.uniforms.uOpacity&&this.uniforms.uOpacity.value!==a&&(this.uniforms.uOpacity.value=a,this.updateShaderSource(),this.dispatchEvent({type:'opacity_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}get pointColorType(){return this._pointColorType}set pointColorType(a){this._pointColorType!==a&&(this._pointColorType=a,this.updateShaderSource(),this.dispatchEvent({type:'point_color_type_changed',target:this}),this.dispatchEvent({type:'material_property_changed',
target:this}))}get pointSizeType(){return this._pointSizeType}set pointSizeType(a){this._pointSizeType!==a&&(this._pointSizeType=a,this.updateShaderSource(),this.dispatchEvent({type:'point_size_type_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}get useEDL(){return this._useEDL}set useEDL(a){this._useEDL!==a&&(this._useEDL=a,this.updateShaderSource())}get color(){return this.uniforms.uColor.value}set color(a){this.uniforms.uColor.value.equals(a)||(this.uniforms.uColor.value.copy(a),
this.dispatchEvent({type:'color_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}get shape(){return this._shape}set shape(a){this._shape!==a&&(this._shape=a,this.updateShaderSource(),this.dispatchEvent({type:'point_shape_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}get treeType(){return this._treeType}set treeType(a){this._treeType!==a&&(this._treeType=a,this.updateShaderSource())}get bbSize(){return this.uniforms.bbSize.value}set bbSize(a){this.uniforms.bbSize.value=
a}get size(){return this.uniforms.size.value}set size(a){this.uniforms.size.value!==a&&(this.uniforms.size.value=a,this.dispatchEvent({type:'point_size_changed',target:this}),this.dispatchEvent({type:'material_property_changed',target:this}))}get elevationRange(){return this.uniforms.elevationRange.value}set elevationRange(a){if(this.uniforms.elevationRange.value[0]!==a[0]||this.uniforms.elevationRange.value[1]!==a[1])this.uniforms.elevationRange.value=a,this._defaultElevationRangeChanged=!0,this.dispatchEvent({type:'material_property_changed',
target:this})}get heightMin(){return this.uniforms.elevationRange.value[0]}set heightMin(a){this.elevationRange=[a,this.elevationRange[1]]}get heightMax(){return this.uniforms.elevationRange.value[1]}set heightMax(a){this.elevationRange=[this.elevationRange[0],a]}get transition(){return this.uniforms.transition.value}set transition(a){this.uniforms.transition.value=a}get intensityRange(){return this.uniforms.intensityRange.value}set intensityRange(a){a instanceof Array&&2===a.length&&(a[0]!==this.uniforms.intensityRange.value[0]||
a[1]!==this.uniforms.intensityRange.value[1])&&(this.uniforms.intensityRange.value=a,this._defaultIntensityRangeChanged=!0,this.dispatchEvent({type:'material_property_changed',target:this}))}get intensityGamma(){return this.uniforms.intensityGamma.value}set intensityGamma(a){this.uniforms.intensityGamma.value!==a&&(this.uniforms.intensityGamma.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get intensityContrast(){return this.uniforms.intensityContrast.value}set intensityContrast(a){this.uniforms.intensityContrast.value!==
a&&(this.uniforms.intensityContrast.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get intensityBrightness(){return this.uniforms.intensityBrightness.value}set intensityBrightness(a){this.uniforms.intensityBrightness.value!==a&&(this.uniforms.intensityBrightness.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get rgbGamma(){return this.uniforms.rgbGamma.value}set rgbGamma(a){this.uniforms.rgbGamma.value!==a&&(this.uniforms.rgbGamma.value=a,
this.dispatchEvent({type:'material_property_changed',target:this}))}get rgbContrast(){return this.uniforms.rgbContrast.value}set rgbContrast(a){this.uniforms.rgbContrast.value!==a&&(this.uniforms.rgbContrast.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get rgbBrightness(){return this.uniforms.rgbBrightness.value}set rgbBrightness(a){this.uniforms.rgbBrightness.value!==a&&(this.uniforms.rgbBrightness.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get weightRGB(){return this.uniforms.wRGB.value}set weightRGB(a){this.uniforms.wRGB.value!==
a&&(this.uniforms.wRGB.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get weightIntensity(){return this.uniforms.wIntensity.value}set weightIntensity(a){this.uniforms.wIntensity.value!==a&&(this.uniforms.wIntensity.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get weightElevation(){return this.uniforms.wElevation.value}set weightElevation(a){this.uniforms.wElevation.value!==a&&(this.uniforms.wElevation.value=a,this.dispatchEvent({type:'material_property_changed',
target:this}))}get weightClassification(){return this.uniforms.wClassification.value}set weightClassification(a){this.uniforms.wClassification.value!==a&&(this.uniforms.wClassification.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get weightReturnNumber(){return this.uniforms.wReturnNumber.value}set weightReturnNumber(a){this.uniforms.wReturnNumber.value!==a&&(this.uniforms.wReturnNumber.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}get weightSourceID(){return this.uniforms.wSourceID.value}set weightSourceID(a){this.uniforms.wSourceID.value!==
a&&(this.uniforms.wSourceID.value=a,this.dispatchEvent({type:'material_property_changed',target:this}))}static generateGradientTexture(a){var b=document.createElement('canvas');b.width=64;b.height=64;var c=b.getContext('2d');c.rect(0,0,64,64);for(var f=c.createLinearGradient(0,0,64,64),d=0;d<a.length;d++){var l=a[d];f.addColorStop(l[0],'#'+l[1].getHexString())}c.fillStyle=f;c.fill();a=new THREE.CanvasTexture(b);a.needsUpdate=!0;a.minFilter=THREE.LinearFilter;return a}static generateClassificationTexture(a){for(var b=
new Uint8Array(262144),c=0;256>c;c++)for(var f=0;256>f;f++){var d=c+256*f;var l=a[c]?a[c]:a[c%32]?a[c%32]:a.DEFAULT;b[4*d]=255*l.x;b[4*d+1]=255*l.y;b[4*d+2]=255*l.z;b[4*d+3]=255*l.w}a=new THREE.DataTexture(b,256,256,THREE.RGBAFormat);a.magFilter=THREE.NearestFilter;a.needsUpdate=!0;return a}disableEvents(){void 0===this._hiddenListeners&&(this._hiddenListeners=this._listeners,this._listeners={})}enableEvents(){this._listeners=this._hiddenListeners;this._hiddenListeners=void 0}copyFrom(a){for(var b of this.uniforms)this.uniforms[b].value=
a.uniforms[b].value}}class aa extends U{constructor(){super();this.children={};this.octree=this.sceneNode=null}getNumPoints(){return this.geometryNode.numPoints}isLoaded(){return!0}isTreeNode(){return!0}isGeometryNode(){return!1}getLevel(){return this.geometryNode.level}getBoundingSphere(){return this.geometryNode.boundingSphere}getBoundingBox(){return this.geometryNode.boundingBox}getChildren(){for(var a=[],b=0;8>b;b++)this.children[b]&&a.push(this.children[b]);return a}getPointsInBox(a){if(!this.sceneNode)return null;
var b=this.geometryNode.buffer,c=b.offset('position'),f=b.stride,d=new DataView(b.data);a=(new THREE.Matrix4).getInverse(a.matrixWorld);a=(new THREE.Matrix4).multiplyMatrices(a,this.sceneNode.matrixWorld);for(var l=[],e=new THREE.Vector4,g=0;g<b.numElements;g++){var h=d.getFloat32(g*f+c+0,!0),m=d.getFloat32(g*f+c+4,!0),n=d.getFloat32(g*f+c+8,!0);e.set(h,m,n,1);e.applyMatrix4(a);-.5<e.x&&.5>e.x&&-.5<e.y&&.5>e.y&&-.5<e.z&&.5>e.z&&(e.set(h,m,n,1).applyMatrix4(this.sceneNode.matrixWorld),l.push(new THREE.Vector3(e.x,
e.y,e.z)))}return l}get name(){return this.geometryNode.name}}class ba extends R{constructor(a,b){super();this.pointBudget=Infinity;this.pcoGeometry=a;this.boundingBox=this.pcoGeometry.boundingBox;this.boundingSphere=this.boundingBox.getBoundingSphere(new THREE.Sphere);this.material=b||new M;this.visiblePointsTarget=2E6;this.minimumNodePixelSize=150;this.level=0;this.position.copy(a.offset);this.updateMatrix();this.showBoundingBox=!1;this.boundingBoxNodes=[];this.loadQueue=[];this.visibleBounds=new THREE.Box3;
this.visibleNodes=[];this.visibleGeometry=[];this.generateDEM=!1;this.profileRequests=[];this.name='';this.tempVector3=new THREE.Vector3;b=[this.pcoGeometry.tightBoundingBox,this.getBoundingBoxWorld()].find(a=>void 0!==a);this.updateMatrixWorld(!0);b=L.computeTransformedBoundingBox(b,this.matrixWorld);var c=b.max.z;this.material.heightMin=b.min.z;this.material.heightMax=c;this.projection=a.projection;this.root=this.pcoGeometry.root}setName(a){this.name!==a&&(this.name=a,this.dispatchEvent({type:'name_changed',
name:a,pointcloud:this}))}getName(){return this.name}toTreeNode(a,b){var c=new aa,f=new THREE.Points(a.geometry,this.material);f.name=a.name;f.position.copy(a.boundingBox.min);f.frustumCulled=!0;f.onBeforeRender=(b,d,f,e,m,g)=>{m.program&&(b.getContext().useProgram(m.program.program),m.program.getUniforms().map.level&&(d=a.getLevel(),m.uniforms.level.value=d,m.program.getUniforms().map.level.setValue(b.getContext(),d)),this.visibleNodeTextureOffsets&&m.program.getUniforms().map.vnStart&&(d=this.visibleNodeTextureOffsets.get(c),
m.uniforms.vnStart.value=d,m.program.getUniforms().map.vnStart.setValue(b.getContext(),d)),m.program.getUniforms().map.pcIndex&&(d=c.pcIndex?c.pcIndex:this.visibleNodes.indexOf(c),m.uniforms.pcIndex.value=d,m.program.getUniforms().map.pcIndex.setValue(b.getContext(),d)))};c.geometryNode=a;c.sceneNode=f;c.pointcloud=this;c.children={};for(var d in a.children)c.children[d]=a.children[d];b?(d=parseInt(a.name[a.name.length-1]),b.sceneNode.add(f),b.children[d]=c):(this.root=c,this.add(f));a.oneTimeDisposeHandlers.push(function(){var d=
parseInt(a.name[a.name.length-1]);b.sceneNode.remove(c.sceneNode);b.children[d]=a});return c}updateVisibleBounds(){for(var a=[],b=0;b<this.visibleNodes.length;b++){for(var c=this.visibleNodes[b],f=!0,d=0;d<c.children.length;d++){var l=c.children[d];l instanceof aa?f=f&&!l.sceneNode.visible:l instanceof N&&(f=!0)}f&&a.push(c)}this.visibleBounds.min=new THREE.Vector3(Infinity,Infinity,Infinity);this.visibleBounds.max=new THREE.Vector3(-Infinity,-Infinity,-Infinity);for(b=0;b<a.length;b++)c=a[b],this.visibleBounds.expandByPoint(c.getBoundingBox().min),
this.visibleBounds.expandByPoint(c.getBoundingBox().max)}updateMaterial(a,b,c,f){a.fov=Math.PI/180*c.fov;a.screenWidth=f.domElement.clientWidth;a.screenHeight=f.domElement.clientHeight;a.spacing=this.pcoGeometry.spacing*Math.max(this.scale.x,this.scale.y,this.scale.z);a.near=c.near;a.far=c.far;a.uniforms.octreeSize.value=this.pcoGeometry.boundingBox.getSize(new THREE.Vector3).x}computeVisibilityTextureData(a,b){w.measureTimings&&performance.mark('computeVisibilityTextureData-start');var c=new Uint8Array(4*
a.length),f=new Map;a=a.slice();a.sort(function(a,b){a=a.geometryNode.name;b=b.geometryNode.name;return a.length!==b.length?a.length-b.length:a<b?-1:a>b?1:0});for(var d=new THREE.Vector3,l=(a,b)=>{d.subVectors(b.center,a.origin);a=d.dot(a.direction);var c=d.dot(d)-a*a;b=b.radius*b.radius;if(c>b)return null;b=a+Math.sqrt(b-c);return 0>b?null:b},e=new Map,g=new Map,h=0;h<a.length;h++){var m=a[h];f.set(m,h);for(var n=[],q=0;8>q;q++){var p=m.children[q];p&&p.constructor===aa&&a.includes(p,h)&&n.push(p)}c[4*
h]=0;c[4*h+1]=0;c[4*h+2]=0;c[4*h+3]=m.getLevel();for(q=0;q<n.length;q++){p=n[q];var r=parseInt(p.geometryNode.name.substr(-1));c[4*h]+=Math.pow(2,r);0===q&&(p=a.indexOf(p,h),c[4*h+1]=p-h>>8,c[4*h+2]=(p-h)%256)}q=m.getBoundingBox().clone().getBoundingSphere(new THREE.Sphere);q.applyMatrix4(m.sceneNode.matrixWorld);q.applyMatrix4(b.matrixWorldInverse);n=new THREE.Ray(b.position,b.getWorldDirection(this.tempVector3));n=l(n,q);q=q.center.distanceTo(b.position)+q.radius;null===n&&(n=q);n=Math.max(n,q);
e.has(m.getLevel())?(q=e.get(m.getLevel()),q=Math.max(q,n),e.set(m.getLevel(),q)):e.set(m.getLevel(),n);if(!m.geometryNode.hasChildren){var t={distance:n,i:h};g.set(m,t)}}for([m,t]of g)if(a=m.getLevel(),n=t.distance,h=t.i,!(4>a)){var u,x;for([u,x]of e)n<1.2*x&&(c[4*h+3]=u)}w.measureTimings&&(performance.mark('computeVisibilityTextureData-end'),performance.measure('render.computeVisibilityTextureData','computeVisibilityTextureData-start','computeVisibilityTextureData-end'));return{data:c,offsets:f}}nodeIntersectsProfile(a,
b){a=a.boundingBox.clone().applyMatrix4(this.matrixWorld).getBoundingSphere(new THREE.Sphere);for(var c=!1,f=0;f<b.points.length-1;f++){var d=new THREE.Vector3(b.points[f+0].x,b.points[f+0].y,a.center.z),l=new THREE.Vector3(b.points[f+1].x,b.points[f+1].y,a.center.z);d=(new THREE.Line3(d,l)).closestPointToPoint(a.center,!0).distanceTo(a.center);c=c||d<a.radius+b.width}return c}nodesOnRay(a,b){var c=[];b=b.clone();for(var f=0;f<a.length;f++){var d=a[f],l=d.getBoundingSphere(new THREE.Sphere).clone().applyMatrix4(this.matrixWorld);
b.intersectsSphere(l)&&c.push(d)}return c}updateMatrixWorld(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1}hideDescendants(a){for(var b=[],c=0;c<a.children.length;c++){var f=a.children[c];f.visible&&b.push(f)}for(;0<b.length;)for(a=b.shift(),a.visible=!1,c=0;c<a.children.length;c++)f=a.children[c],f.visible&&
b.push(f)}moveToOrigin(){this.position.set(0,0,0);this.updateMatrixWorld(!0);var a=L.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld);this.position.set(0,0,0).sub(a.getCenter(new THREE.Vector3))}moveToGroundPlane(){this.updateMatrixWorld(!0);var a=L.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld);this.position.y+=-a.min.y}getBoundingBoxWorld(){this.updateMatrixWorld(!0);return L.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld)}getPointsInProfile(a,
b,c){c={segments:[],boundingBox:new THREE.Box3,projectedBoundingBox:new THREE.Box2};for(var f=0;f<a.points.length-1;f++){var d=a.points[f],l=a.points[f+1],e=this.getProfile(d,l,a.width,b),g={start:d,end:l,points:e,project:null};c.segments.push(g);c.boundingBox.expandByPoint(e.boundingBox.min);c.boundingBox.expandByPoint(e.boundingBox.max)}a=new THREE.Vector3;for(f=0;f<c.segments.length;f++)g=c.segments[f],d=g.start,l=g.end,b=function(a,b,c,d){var f=new THREE.Vector3(1,0,0);b=(new THREE.Vector3).subVectors(b,
a);b.y=0;b.normalize();var l=Math.acos(f.dot(b));0<b.z&&(l=-l);return function(b){var f=(new THREE.Matrix4).makeTranslation(-a.x,-d.min.y,-a.z),e=(new THREE.Matrix4).makeRotationY(-l),h=(new THREE.Matrix4).makeTranslation(c.x,0,0);b=b.clone();b.applyMatrix4(f);b.applyMatrix4(e);b.applyMatrix4(h);return b}}(d,l,a.clone(),c.boundingBox.clone()),g.project=b,a.x+=(new THREE.Vector3(d.x,0,d.z)).distanceTo(new THREE.Vector3(l.x,0,l.z)),a.y+=l.y-d.y;c.projectedBoundingBox.min.x=0;c.projectedBoundingBox.min.y=
c.boundingBox.min.y;c.projectedBoundingBox.max.x=a.x;c.projectedBoundingBox.max.y=c.boundingBox.max.y;return c}getProfile(a,b,c,f,d){}getVisibleExtent(){return this.visibleBounds.applyMatrix4(this.matrixWorld)}pick(a,b,c,f={}){var d=a.renderer,l=a.pRenderer;performance.mark('pick-start');var e=(a,b)=>void 0!==a?a:b;a=e(f.pickWindowSize,17);e(f.pickOutsideClipRegion,!1);var g=d.getSize(new THREE.Vector3),h=Math.ceil(e(f.width,g.width));g=Math.ceil(e(f.height,g.height));var m=e(f.pointSizeType,this.material.pointSizeType);
e=e(f.pointSize,this.material.size);c=this.nodesOnRay(this.visibleNodes,c);if(0===c.length)return null;if(!this.pickState){var n=new THREE.Scene,q=new M;q.pointColorType=B.POINT_INDEX;this.pickState={renderTarget:new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),material:q,scene:n}}n=this.pickState;q=n.material;q.pointSizeType=m;q.shape=this.material.shape;q.size=e;q.uniforms.minSize.value=this.material.uniforms.minSize.value;q.uniforms.maxSize.value=
this.material.uniforms.maxSize.value;q.classification=this.material.classification;f.pickClipped?(q.clipBoxes=this.material.clipBoxes,q.clipTask=this.material.clipTask===S.HIGHLIGHT?S.NONE:this.material.clipTask):q.clipBoxes=[];this.updateMaterial(q,c,b,d);n.renderTarget.setSize(h,g);e=new THREE.Vector2(f.x,f.y);m=d.getContext();m.enable(m.SCISSOR_TEST);m.scissor(parseInt(e.x-(a-1)/2),parseInt(e.y-(a-1)/2),parseInt(a),parseInt(a));d.state.buffers.depth.setTest(q.depthTest);d.state.buffers.depth.setMask(q.depthWrite);
d.state.setBlending(THREE.NoBlending);d.setRenderTarget(n.renderTarget);m.clearColor(0,0,0,0);d.clearTarget(n.renderTarget,!0,!0,!0);var p=this.material;this.material=q;l.renderOctree(this,c,b,n.renderTarget);this.material=p;b=parseInt(Math.min(Math.max(0,e.x-(a-1)/2),h));l=parseInt(Math.min(Math.max(0,e.y-(a-1)/2),g));h=parseInt(Math.min(b+a,h)-b);g=parseInt(Math.min(l+a,g)-l);h=new Uint8Array(4*h*g);m.readPixels(b,l,a,a,m.RGBA,m.UNSIGNED_BYTE,h);d.setRenderTarget(null);d.resetGLState();d.setScissorTest(!1);
m.disable(m.SCISSOR_TEST);g=new Uint32Array(h.buffer);d=[];for(b=0;b<a;b++)for(l=0;l<a;l++)if(n=b+l*a,m=Math.pow(b-(a-1)/2,2)+Math.pow(l-(a-1)/2,2),e=h[4*n+3],h[4*n+3]=0,n=g[n],(0!==e||0!==n)&&void 0!==e&&void 0!==n){var r={pIndex:n,pcIndex:e,distanceToCenter:m};f.all?d.push(r):0<d.length?m<d[0].distanceToCenter&&(d[0]=r):d.push(r)}for(r of d){a={};if(!c[r.pcIndex])return null;g=c[r.pcIndex];h=g.sceneNode;g=g.geometryNode.geometry;for(var t in g.attributes)m=g.attributes[t],'position'===t&&(b=m.array[3*
r.pIndex],l=m.array[3*r.pIndex+1],b=new THREE.Vector3(b,l,m.array[3*r.pIndex+2]),b.applyMatrix4(h.matrixWorld),a[t]=b);r.point=a}performance.mark('pick-end');performance.measure('pick','pick-start','pick-end');return f.all?d.map(a=>a.point):0===d.length?null:d[0].point}*getFittedBoxGen(a){var b=new THREE.Box3,c=(new THREE.Matrix4).getInverse(a.matrixWorld);for(r of this.visibleNodes)if(r.sceneNode){for(var f=r.geometryNode.buffer,d=f.offset('position'),l=f.stride,e=new DataView(f.data),g=(new THREE.Matrix4).multiplyMatrices(c,
r.sceneNode.matrixWorld),h=new THREE.Vector4,m=0;m<f.numElements;m++){var n=e.getFloat32(m*l+d+0,!0),q=e.getFloat32(m*l+d+4,!0),p=e.getFloat32(m*l+d+8,!0);h.set(n,q,p,1);h.applyMatrix4(g);-.5<h.x&&.5>h.x&&-.5<h.y&&.5>h.y&&-.5<h.z&&.5>h.z&&b.expandByPoint(h)}yield}var r=b.getCenter(new THREE.Vector3).applyMatrix4(a.matrixWorld);c=new THREE.Object3D;c.position.copy(r);c.scale.copy(a.scale);c.rotation.copy(a.rotation);a=(new THREE.Vector3).subVectors(b.max,b.min);c.scale.multiply(a);yield c}getFittedBox(a,
b=Infinity){var c=new THREE.Box3,f=(new THREE.Matrix4).getInverse(a.matrixWorld),d;for(d of this.visibleNodes)if(d.sceneNode&&!(d.getLevel()>b))for(var e=d.geometryNode.buffer,k=e.offset('position'),g=e.stride,h=new DataView(e.data),m=(new THREE.Matrix4).multiplyMatrices(f,d.sceneNode.matrixWorld),n=new THREE.Vector4,q=0;q<e.numElements;q++){var p=h.getFloat32(q*g+k+0,!0),r=h.getFloat32(q*g+k+4,!0),t=h.getFloat32(q*g+k+8,!0);n.set(p,r,t,1);n.applyMatrix4(m);-.5<n.x&&.5>n.x&&-.5<n.y&&.5>n.y&&-.5<n.z&&
.5>n.z&&c.expandByPoint(n)}f=c.getCenter(new THREE.Vector3).applyMatrix4(a.matrixWorld);b=new THREE.Object3D;b.position.copy(f);b.scale.copy(a.scale);b.rotation.copy(a.rotation);a=(new THREE.Vector3).subVectors(c.max,c.min);b.scale.multiply(a);return b}get progress(){return this.visibleNodes.length/this.visibleGeometry.length}find(a){var b=null,c;for(c of a)b='r'===c?this.root:b.children[c];return b}}class fa extends U{constructor(){super();this.kdtree=this.sceneNode=this.right=this.left=null}getNumPoints(){return this.geometryNode.numPoints}isLoaded(){return!0}isTreeNode(){return!0}isGeometryNode(){return!1}getLevel(){return this.geometryNode.level}getBoundingSphere(){return this.geometryNode.boundingSphere}getBoundingBox(){return this.geometryNode.boundingBox}toTreeNode(a){var b=
null;this.left===a?b=this.left:this.right===a&&(b=this.right);if(b.loaded){a=new fa;var c=THREE.PointCloud(b.geometry,this.kdtree.material);c.visible=!1;a.kdtree=this.kdtree;a.geometryNode=b;a.sceneNode=c;a.parent=this;a.left=this.geometryNode.left;a.right=this.geometryNode.right}}getChildren(){var a=[];this.left&&a.push(this.left);this.right&&a.push(this.right);return a}}class Da extends R{constructor(a){super();this.root=null;a.root?this.root=a.root:a.addEventListener('hierarchy_loaded',()=>{this.root=
a.root});this.visiblePointsTarget=2E6;this.minimumNodePixelSize=150;this.position.sub(a.offset);this.updateMatrix();this.numVisiblePoints=this.numVisibleNodes=0;this.boundingBoxNodes=[];this.loadQueue=[];this.visibleNodes=[];this.pcoGeometry=a;this.boundingBox=this.pcoGeometry.boundingBox;this.boundingSphere=this.pcoGeometry.boundingSphere;this.material=new M({vertexColors:THREE.VertexColors,size:.05,treeType:V.KDTREE});this.material.sizeType=P.ATTENUATED;this.material.size=.05;this.profileRequests=
[];this.name=''}getBoundingBoxWorld(){this.updateMatrixWorld(!0);return L.computeTransformedBoundingBox(this.boundingBox,this.matrixWorld)}setName(a){this.name!==a&&(this.name=a,this.dispatchEvent({type:'name_changed',name:a,pointcloud:this}))}getName(){return this.name}getLevel(){return this.level}toTreeNode(a,b){var c=new fa,f=new THREE.Points(a.geometry,this.material);f.frustumCulled=!0;f.onBeforeRender=(b,f,e,g,h,m)=>{h.program&&(b.getContext().useProgram(h.program.program),h.program.getUniforms().map.level&&
(f=a.getLevel(),h.uniforms.level.value=f,h.program.getUniforms().map.level.setValue(b.getContext(),f)),this.visibleNodeTextureOffsets&&h.program.getUniforms().map.vnStart&&(f=this.visibleNodeTextureOffsets.get(c),h.uniforms.vnStart.value=f,h.program.getUniforms().map.vnStart.setValue(b.getContext(),f)),h.program.getUniforms().map.pcIndex&&(f=c.pcIndex?c.pcIndex:this.visibleNodes.indexOf(c),h.uniforms.pcIndex.value=f,h.program.getUniforms().map.pcIndex.setValue(b.getContext(),f)))};c.geometryNode=
a;c.sceneNode=f;c.pointcloud=this;c.left=a.left;c.right=a.right;b?(b.sceneNode.add(f),b.left===a?b.left=c:b.right===a&&(b.right=c)):(this.root=c,this.add(f));a.oneTimeDisposeHandlers.push(function(){b.sceneNode.remove(c.sceneNode);b.left===c?b.left=a:b.right===c&&(b.right=a)});return c}updateMaterial(a,b,c,f){a.fov=Math.PI/180*c.fov;a.screenWidth=f.domElement.clientWidth;a.screenHeight=f.domElement.clientHeight;a.spacing=this.pcoGeometry.spacing;a.near=c.near;a.far=c.far;this.maxLevel>a.levels&&(a.levels=
this.maxLevel+2);b=this.boundingBox.getSize(new THREE.Vector3);a.bbSize=[b.x,b.y,b.z]}updateVisibleBounds(){}hideDescendants(a){for(var b=[],c=0;c<a.children.length;c++){var f=a.children[c];f.visible&&b.push(f)}for(;0<b.length;)for(f=b.shift(),f.visible=!1,f.boundingBoxNode&&(f.boundingBoxNode.visible=!1),c=0;c<f.children.length;c++)a=f.children[c],a.visible&&b.push(a)}updateMatrixWorld(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?
this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1}nodesOnRay(a,b){var c=[];b=b.clone();for(var f=0;f<a.length;f++){var d=a[f],e=d.getBoundingSphere(new THREE.Sphere).clone().applyMatrix4(d.sceneNode.matrixWorld);b.intersectsSphere(e)&&c.push(d)}return c}pick(a,b,c,f={}){var d=a.renderer,e=a.pRenderer;performance.mark('pick-start');var k=(a,b)=>void 0!==a?a:b;a=k(f.pickWindowSize,17);k(f.pickOutsideClipRegion,!1);
var g=d.getSize(new THREE.Vector3),h=Math.ceil(k(f.width,g.width));g=Math.ceil(k(f.height,g.height));var m=k(f.pointSizeType,this.material.pointSizeType);k=k(f.pointSize,this.material.size);c=this.nodesOnRay(this.visibleNodes,c);if(0===c.length)return null;if(!this.pickState){var n=new THREE.Scene,q=new M;q.pointColorType=B.POINT_INDEX;this.pickState={renderTarget:new THREE.WebGLRenderTarget(1,1,{minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat}),material:q,scene:n}}n=
this.pickState;q=n.material;q.pointSizeType=m;q.shape=this.material.shape;q.size=k;q.uniforms.minSize.value=this.material.uniforms.minSize.value;q.uniforms.maxSize.value=this.material.uniforms.maxSize.value;q.classification=this.material.classification;f.pickClipped?(q.clipBoxes=this.material.clipBoxes,q.clipTask=this.material.clipTask===S.HIGHLIGHT?S.NONE:this.material.clipTask):q.clipBoxes=[];this.updateMaterial(q,c,b,d);n.renderTarget.setSize(h,g);k=new THREE.Vector2(f.x,f.y);m=d.getContext();
m.enable(m.SCISSOR_TEST);m.scissor(parseInt(k.x-(a-1)/2),parseInt(k.y-(a-1)/2),parseInt(a),parseInt(a));d.state.buffers.depth.setTest(q.depthTest);d.state.buffers.depth.setMask(q.depthWrite);d.state.setBlending(THREE.NoBlending);d.clearTarget(n.renderTarget,!0,!0,!0);d.setRenderTarget(n.renderTarget);m.clearColor(0,0,0,0);d.clearTarget(n.renderTarget,!0,!0,!0);var p=this.material;this.material=q;e.renderOctree(this,c,b,n.renderTarget);this.material=p;b=parseInt(Math.min(Math.max(0,k.x-(a-1)/2),h));
e=parseInt(Math.min(Math.max(0,k.y-(a-1)/2),g));h=parseInt(Math.min(b+a,h)-b);g=parseInt(Math.min(e+a,g)-e);h=new Uint8Array(4*h*g);m.readPixels(b,e,a,a,m.RGBA,m.UNSIGNED_BYTE,h);d.setRenderTarget(null);d.resetGLState();d.setScissorTest(!1);m.disable(m.SCISSOR_TEST);g=new Uint32Array(h.buffer);d=[];for(b=0;b<a;b++)for(e=0;e<a;e++)if(n=b+e*a,m=Math.pow(b-(a-1)/2,2)+Math.pow(e-(a-1)/2,2),k=h[4*n+3],h[4*n+3]=0,n=g[n],(0!==k||0!==n)&&void 0!==k&&void 0!==n){var r={pIndex:n,pcIndex:k,distanceToCenter:m};
f.all?d.push(r):0<d.length?m<d[0].distanceToCenter&&(d[0]=r):d.push(r)}for(r of d){a={};if(!c[r.pcIndex])return null;g=c[r.pcIndex];h=g.sceneNode;g=g.geometryNode.geometry;for(var t in g.attributes)m=g.attributes[t],'position'===t&&(b=m.array[3*r.pIndex],e=m.array[3*r.pIndex+1],b=new THREE.Vector3(b,e,m.array[3*r.pIndex+2]),b.applyMatrix4(h.matrixWorld),a[t]=b);r.point=a}performance.mark('pick-end');performance.measure('pick','pick-start','pick-end');return f.all?d.map(a=>a.point):0===d.length?null:
d[0].point}computeVisibilityTextureData(a){w.measureTimings&&performance.mark('computeVisibilityTextureData-start');var b=new Uint8Array(3*a.length),c=new Map;a=a.slice();a.sort(function(a,b){var c=a.geometryNode.level,d=b.geometryNode.level;a=a.geometryNode.number;b=b.geometryNode.number;return c!==d?c-d:a<b?-1:a>b?1:0});for(var f=[],d=0;d<a.length;d++)f.push(a[d].geometryNode.number);for(d=0;d<a.length;d++){var e=a[d];c.set(e,d);var k=0,g=0,h=0;e.geometryNode.left&&0<f.indexOf(e.geometryNode.left.number)&&
(k+=1,g=f.indexOf(e.geometryNode.left.number)-d);e.geometryNode.right&&0<f.indexOf(e.geometryNode.right.number)&&(k+=2,g=0===g?f.indexOf(e.geometryNode.right.number)-d:g);'X'===e.geometryNode.split?h=1:'Y'===e.geometryNode.split?h=2:'Z'===e.geometryNode.split&&(h=4);b[3*d]=k;b[3*d+1]=g;b[3*d+2]=h}w.measureTimings&&(performance.mark('computeVisibilityTextureData-end'),performance.measure('render.computeVisibilityTextureData','computeVisibilityTextureData-start','computeVisibilityTextureData-end'));
return{data:b,offsets:c}}get progress(){return this.pcoGeometry.root?0<w.numNodesLoading?0:1:0}}class Ma{constructor(){this.pcoGeometry=this.number=this.boundingBox=this.right=this.left=null;this.loaded=!1;this.level=this.numPoints=0;this.children=[];this.oneTimeDisposeHandlers=[]}isGeometryNode(){return!0}isTreeNode(){return!1}isLoaded(){return this.loaded}getBoundingSphere(){return this.boundingSphere}getBoundingBox(){return this.boundingBox}getChildren(){var a=[];this.left&&a.push(this.left);this.right&&
a.push(this.right);return a}getLevel(){return this.level}load(){if(!(this.loaded||this.loading||w.numNodesLoading>=w.maxNodesLoading)){this.loading=!0;w.numNodesLoading++;var a=this,b=this.pcoGeometry.url+'?node='+this.number,c=new XMLHttpRequest;c.overrideMimeType('text/plain');c.open('GET',b,!0);c.responseType='arraybuffer';c.onload=function(){try{var b=c.response,d=new DataView(b),e=b.byteLength/17,k=new ArrayBuffer(28*e);new DataView(k);var g=new Float32Array(3*e),h=new Uint8Array(4*e),m=new Float32Array(e),
n=new Uint8Array(e),q=new ArrayBuffer(4*e),p=new Uint32Array(q),r=new THREE.Box3;for(b=0;b<e;b++){var t=d.getFloat32(17*b,!0)+a.boundingBox.min.x,u=d.getFloat32(17*b+4,!0)+a.boundingBox.min.y,x=d.getFloat32(17*b+8,!0)+a.boundingBox.min.z,y=d.getUint8(17*b+12,!0),z=d.getUint8(17*b+13,!0),A=d.getUint8(17*b+14,!0),B=d.getUint8(17*b+15,!0),C=d.getUint8(17*b+16,!0);r.expandByPoint(new THREE.Vector3(t,u,x));g[3*b]=t;g[3*b+1]=u;g[3*b+2]=x;h[4*b]=y;h[4*b+1]=z;h[4*b+2]=A;h[4*b+3]=255;m[b]=B;n[b]=C;p[b]=b}var D=
new THREE.BufferGeometry;D.setAttribute('position',new THREE.BufferAttribute(g,3));D.setAttribute('color',new THREE.BufferAttribute(h,4,!0));D.setAttribute('intensity',new THREE.BufferAttribute(m,1));D.setAttribute('classification',new THREE.BufferAttribute(n,1));var E=new THREE.BufferAttribute(new Uint8Array(q),4,!0);D.setAttribute('indices',E);a.geometry=D;a.numPoints=e;a.loaded=!0;a.loading=!1;w.numNodesLoading--}catch(Na){console.error('Potree: Exception thrown parsing points.',Na),w.numNodesLoading--}};
c.onerror=function(){w.numNodesLoading--;console.log('Potree: Failed to load file, '+c.status+', file: '+b)};c.send(null)}}dispose(){if(this.geometry&&null!=this.parent){this.geometry.dispose();this.geometry=null;this.loaded=!1;for(var a=0;a<this.oneTimeDisposeHandlers.length;a++)(0,this.oneTimeDisposeHandlers[a])();this.oneTimeDisposeHandlers=[]}}getNumPoints(){return this.numPoints}}class ha extends THREE.EventDispatcher{constructor(){super();this.version=this.numPoints=0;this.boundingBox=null;
this.numNodes=0;this.root=this.url=this.provider=this.name=null;this.levels=0;this._spacing=null;this.pointAttributes=new t(['POSITION_CARTESIAN','COLOR_PACKED'])}static load(a,b){var c=new XMLHttpRequest;c.overrideMimeType('text/plain');c.open('GET',a+'?info',!0);c.onreadystatechange=function(){try{if(4===c.readyState&&200===c.status){var f=JSON.parse(c.responseText),d=new ha;d.url=a;d.name=f.Name;d.provider=f.Provider;d.numNodes=f.Nodes;d.numPoints=f.Points;d.version=f.Version;d.boundingBox=new THREE.Box3((new THREE.Vector3).fromArray(f.BoundingBox.slice(0,
3)),(new THREE.Vector3).fromArray(f.BoundingBox.slice(3,6)));f.Spacing&&(d.spacing=f.Spacing);var e=d.boundingBox.min.clone().multiplyScalar(-1);d.boundingBox.min.add(e);d.boundingBox.max.add(e);d.offset=e;var k=new THREE.Vector3;d.boundingBox.getCenter(k);var g=d.boundingBox.getSize(new THREE.Vector3).length()/2;d.boundingSphere=new THREE.Sphere(k,g);d.loadHierarchy();b(d)}else 4===c.readyState&&b(null)}catch(h){console.error(h.message),b(null)}};c.send(null)}loadHierarchy(){var a=this.url+'?tree',
b=new XMLHttpRequest;b.overrideMimeType('text/plain');b.open('GET',a,!0);b.responseType='arraybuffer';b.onreadystatechange=()=>{if(4===b.readyState&&200===b.status){var a=b.response,f=a.byteLength/3;a=new DataView(a);for(var d=[],e=null,g=0,v=0;v<f;v++){var h=a.getUint8(3*v,!0),m=0<(h&1),n=0<(h&2),q=0<(h&8),p=0<(h&16),r=null;0<(h&4)?r='X':q&&(r='Y');p&&(r='Z');h=new Ma;h.hasLeft=m;h.hasRight=n;h.split=r;h.isLeaf=!m&&!n;h.number=v;h.left=null;h.right=null;h.pcoGeometry=this;h.level=d.length;g=Math.max(g,
h.level);0<d.length?(m=d[d.length-1],h.boundingBox=m.boundingBox.clone(),n=m.boundingBox.getSize(new THREE.Vector3),m.hasLeft&&!m.left?(m.left=h,m.children.push(h),'X'===m.split?h.boundingBox.max.x=h.boundingBox.min.x+n.x/2:'Y'===m.split?h.boundingBox.max.y=h.boundingBox.min.y+n.y/2:'Z'===m.split&&(h.boundingBox.max.z=h.boundingBox.min.z+n.z/2),m=new THREE.Vector3,h.boundingBox.getCenter(m),n=h.boundingBox.getSize(new THREE.Vector3).length()/2):(m.right=h,m.children.push(h),'X'===m.split?h.boundingBox.min.x+=
n.x/2:'Y'===m.split?h.boundingBox.min.y+=n.y/2:'Z'===m.split&&(h.boundingBox.min.z+=n.z/2),m=new THREE.Vector3,h.boundingBox.getCenter(m),n=h.boundingBox.getSize(new THREE.Vector3).length()/2),h.boundingSphere=new THREE.Sphere(m,n)):(e=h,e.boundingBox=this.boundingBox.clone(),m=new THREE.Vector3,e.boundingBox.getCenter(m),n=e.boundingBox.getSize(new THREE.Vector3).length()/2,e.boundingSphere=new THREE.Sphere(m,n));m=h.boundingBox.getSize(new THREE.Vector3);h.spacing=(m.x+m.y+m.z)/3/75;h.estimatedSpacing=
h.spacing;d.push(h);if(h.isLeaf)for(h=!1;!h&&0<d.length;)d.pop(),h=d[d.length-1],h=0<d.length&&h.hasRight&&null==h.right}this.root=e;this.levels=g;this.dispatchEvent({type:'hierarchy_loaded'})}};b.send(null)}get spacing(){if(this._spacing)return this._spacing;if(this.root)return this.root.spacing}set spacing(a){this._spacing=a}}da.prototype={push:function(a){this.content.push(a);this.bubbleUp(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();0<this.content.length&&
(this.content[0]=b,this.sinkDown(0));return a},remove:function(a){for(var b=this.content.length,c=0;c<b;c++)if(this.content[c]==a){a=this.content.pop();if(c==b-1)break;this.content[c]=a;this.bubbleUp(c);this.sinkDown(c);break}},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a],c=this.scoreFunction(b);0<a;){var f=Math.floor((a+1)/2)-1,d=this.content[f];if(c>=this.scoreFunction(d))break;this.content[f]=b;this.content[a]=d;a=f}},sinkDown:function(a){for(var b=
this.content.length,c=this.content[a],f=this.scoreFunction(c);;){var d=2*(a+1),e=d-1,g=null;if(e<b){var v=this.scoreFunction(this.content[e]);v<f&&(g=e)}d<b&&this.scoreFunction(this.content[d])<(null==g?f:v)&&(g=d);if(null==g)break;this.content[a]=this.content[g];this.content[g]=c;a=g}}};var X={position:0,color:1,intensity:2,classification:3,returnNumber:4,numberOfReturns:5,pointSourceID:6,indices:7,normal:8,spacing:9},Ca={DEFAULT:{0:new THREE.Vector4(.5,.5,.5,1),1:new THREE.Vector4(.5,.5,.5,1),2:new THREE.Vector4(.63,
.32,.18,1),3:new THREE.Vector4(0,1,0,1),4:new THREE.Vector4(0,.8,0,1),5:new THREE.Vector4(0,.6,0,1),6:new THREE.Vector4(1,.66,0,1),7:new THREE.Vector4(1,0,1,1),8:new THREE.Vector4(1,0,0,1),9:new THREE.Vector4(0,0,1,1),12:new THREE.Vector4(1,1,0,1),DEFAULT:new THREE.Vector4(.3,.6,.6,.5)}},S={NONE:0,HIGHLIGHT:1,SHOW_INSIDE:2,SHOW_OUTSIDE:3},P={FIXED:0,ATTENUATED:1,ADAPTIVE:2},W={SQUARE:0,CIRCLE:1,PARABOLOID:2},B={RGB:0,COLOR:1,DEPTH:2,HEIGHT:3,ELEVATION:3,INTENSITY:4,INTENSITY_GRADIENT:5,LOD:6,LEVEL_OF_DETAIL:6,
POINT_INDEX:7,CLASSIFICATION:8,RETURN_NUMBER:9,SOURCE:10,NORMAL:11,PHONG:12,RGB_HEIGHT:13,COMPOSITE:50},V={OCTREE:0,KDTREE:1};class Oa{constructor(){this.boundingBox=new THREE.Box3;this.numPoints=0;this.data={}}add(a){var b=this.numPoints,c=b+a.numPoints,f=Object.keys(this.data),d=Object.keys(a.data),e=new Set([...f,...d]),g;for(g of e)if(f.includes(g)&&d.includes(g)){var v=this.data[g].constructor;e=new v(this.data[g].length+a.data[g].length);e.set(this.data[g],0);e.set(a.data[g],this.data[g].length);
this.data[g]=e}else f.includes(g)&&!d.includes(g)?(e=this.data[g].length/this.numPoints,v=this.data[g].constructor,v=new v(e*c),v.set(this.data[g],0),this.data[g]=v):!f.includes(g)&&d.includes(g)&&(e=a.data[g].length/a.numPoints,v=a.data[g].constructor,v=new v(e*c),v.set(a.data[g],e*b),this.data[g]=v);this.numPoints=c;this.boundingBox.union(a.boundingBox)}}class ia{constructor(a,b){this.gl=a;this.texture=b;this.id=a.createTexture();this.target=a.TEXTURE_2D;this.version=-1;this.update(b)}update(){if(this.texture.image){var a=
this.gl,b=this.texture;if(this.version!==b.version){this.target=a.TEXTURE_2D;a.bindTexture(this.target,this.id);var c=K(a,b.format),f=b.image.width,d=b.image.height,e=K(a,b.type);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);if(b instanceof THREE.DataTexture){var g=b.image.data;a.texParameteri(this.target,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(this.target,a.TEXTURE_WRAP_T,
a.CLAMP_TO_EDGE);a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,K(a,b.magFilter));a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,K(a,b.minFilter));a.texImage2D(this.target,0,c,f,d,0,c,e,g)}else b instanceof THREE.CanvasTexture&&(g=b.image,a.texParameteri(this.target,a.TEXTURE_WRAP_S,K(a,b.wrapS)),a.texParameteri(this.target,a.TEXTURE_WRAP_T,K(a,b.wrapT)),a.texParameteri(this.target,a.TEXTURE_MAG_FILTER,K(a,b.magFilter)),a.texParameteri(this.target,a.TEXTURE_MIN_FILTER,K(a,b.minFilter)),a.texImage2D(this.target,
0,c,c,e,g));a.bindTexture(this.target,null);this.version=b.version}}else this.version=this.texture.version}}class Ea{constructor(a,b,c,f){this.gl=a;this.name=b;this.vsSource=c;this.fsSource=f;this.cache=new Map;this.program=this.fs=this.vs=null;this.uniformLocations={};this.attributeLocations={};this.update(c,f)}update(a,b){this.vsSource=a;this.fsSource=b;this.linkProgram()}compileShader(a,b){var c=this.gl;c.shaderSource(a,b);c.compileShader(a);if(!c.getShaderParameter(a,c.COMPILE_STATUS))throw a=
c.getShaderInfoLog(a),Error('Potree: Could not compile shader '+this.name+', '+a);}linkProgram(){var a=this.gl;this.uniformLocations={};this.attributeLocations={};a.useProgram(null);var b=this.cache.get(`${this.vsSource}, ${this.fsSource}`);if(b)this.program=b.program,this.vs=b.vs,this.fs=b.fs,this.attributeLocations=b.attributeLocations,this.uniformLocations=b.uniformLocations;else{this.vs=a.createShader(a.VERTEX_SHADER);this.fs=a.createShader(a.FRAGMENT_SHADER);this.program=a.createProgram();for(var c of Object.keys(X))b=
X[c],a.bindAttribLocation(this.program,b,c);this.compileShader(this.vs,this.vsSource);this.compileShader(this.fs,this.fsSource);c=this.program;a.attachShader(c,this.vs);a.attachShader(c,this.fs);a.linkProgram(c);a.detachShader(c,this.vs);a.detachShader(c,this.fs);if(!a.getProgramParameter(c,a.LINK_STATUS))throw a=a.getProgramInfoLog(c),Error('Potree: Could not link program '+this.name+', '+a);for(var f=a.getProgramParameter(c,a.ACTIVE_ATTRIBUTES),d=0;d<f;d++){var e=a.getActiveAttrib(c,d);b=a.getAttribLocation(c,
e.name);this.attributeLocations[e.name]=b}f=a.getProgramParameter(c,a.ACTIVE_UNIFORMS);for(d=0;d<f;d++)e=a.getActiveUniform(c,d),b=a.getUniformLocation(c,e.name),this.uniformLocations[e.name]=b;b={program:this.program,vs:this.vs,fs:this.fs,attributeLocations:this.attributeLocations,uniformLocations:this.uniformLocations};this.cache.set(`${this.vsSource}, ${this.fsSource}`,b)}}setUniformMatrix4(a,b){const c=this.gl;a=this.uniformLocations[a];null!=a&&(b=new Float32Array(b.elements),c.uniformMatrix4fv(a,
!1,b))}setUniform1f(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1f(a,b)}setUniformBoolean(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)}setUniformTexture(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)}setUniform2f(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform2f(a,b[0],b[1])}setUniform3f(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform3f(a,b[0],b[1],b[2])}setUniform(a,b){b.constructor===THREE.Matrix4?this.setUniformMatrix4(a,b):'number'===
typeof b?this.setUniform1f(a,b):'boolean'===typeof b?this.setUniformBoolean(a,b):b instanceof ia?this.setUniformTexture(a,b):b instanceof Array?2===b.length?this.setUniform2f(a,b):3===b.length&&this.setUniform3f(a,b):console.error('Potree: Unhandled uniform type: ',a,b)}setUniform1i(a,b){a=this.uniformLocations[a];null!=a&&this.gl.uniform1i(a,b)}}class Fa{constructor(){this.numElements=0;this.vao=null;this.vbos=new Map}}class Ga extends THREE.Mesh{constructor(){super(new THREE.Geometry,new THREE.MeshBasicMaterial({opacity:0,
wireframe:!1,alphaTest:1}));this.frustumCulled=!0;this.pointclouds=[];this.nodeSize=30;this.pointBudget=1E10;this.nodeLoadRate=2}raycast(a,b){}setPointBudget(a){this.pointBudget=a}onBeforeRender(a,b,c,f,d,e){for(b=0;b<this.pointclouds.length;b++)this.pointclouds[b].minimumNodePixelSize=this.nodeSize;ma(this.pointclouds,c,a)}recalculateBoxGeometry(){var a=this.getBoundingBox(),b=a.getSize(new THREE.Vector3),c=a.getCenter(new THREE.Vector3);a=new THREE.Matrix4;a.makeTranslation(c.x,c.y,c.z);b=new THREE.BoxBufferGeometry(b.x,
b.y,b.z);b.applyMatrix(a);this.geometry=b}add(a){THREE.Object3D.prototype.add.call(this,a);a instanceof R&&(a.showBoundingBox=!1,a.generateDEM=!1,this.pointclouds.push(a),this.recalculateBoxGeometry())}remove(a){THREE.Object3D.prototype.remove.call(this,a);a instanceof R&&(a=this.pointclouds.indexOf(a),-1!==a&&(this.pointclouds.splice(a,1),this.recalculateBoxGeometry()))}getBoundingBox(){var a=new THREE.Box3;this.updateMatrixWorld(!0);for(var b=0;b<this.pointclouds.length;b++){var c=this.pointclouds[b];
c.updateMatrixWorld(!0);c=L.computeTransformedBoundingBox(c.pcoGeometry.tightBoundingBox?c.pcoGeometry.tightBoundingBox:c.boundingBox,c.matrixWorld);a.union(c)}return a}estimateHeightAt(a){var b=null,c=Infinity,f;for(f of this.pointclouds)if(void 0!==f.root.geometryNode){var d=null,e=Infinity,g=a.clone().sub(f.position);g.z=0;g=new THREE.Ray(g,new THREE.Vector3(0,0,1));for(var v=[f.root];0<v.length;){var h=v.pop(),m=h.getBoundingBox();if(g.intersectBox(m)){m=h.geometryNode.mean.z+f.position.z+h.geometryNode.boundingBox.min.z;
h.geometryNode.spacing<=e&&(d=m,e=h.geometryNode.spacing);for(var n of Object.keys(h.children))h.children[n].geometryNode&&v.push(h.children[n])}}if(null===b||e<c)b=d,c=e}return b}}class Pa extends Ga{constructor(){super();this.buffers=new Map;this.shaders=new Map;this.textures=new Map;this.types=new Map}getExtensions(a){this.types.set(Float32Array,a.FLOAT);this.types.set(Uint8Array,a.UNSIGNED_BYTE);this.types.set(Uint16Array,a.UNSIGNED_SHORT);var b=a.getExtension('OES_vertex_array_object');a.createVertexArray=
b.createVertexArrayOES.bind(b);a.bindVertexArray=b.bindVertexArrayOES.bind(b)}onBeforeRender(a,b,c,e,d,g){super.onBeforeRender(a,b,c,e,d,g);b=a.getContext();void 0===b.bindVertexArray&&this.getExtensions(b);e=this.fetchOctrees();for(var f of e.octrees)this.renderOctree(a,f,f.visibleNodes,c);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,null);a.state.reset()}createBuffer(a,b){var c=new Fa;c.vao=a.createVertexArray();c.numElements=b.attributes.position.count;a.bindVertexArray(c.vao);for(var e in b.attributes){var d=
b.attributes[e],g=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g);a.bufferData(a.ARRAY_BUFFER,d.array,a.STATIC_DRAW);var k=X[e],v=d.normalized,h=this.types.get(d.array.constructor);void 0!==h&&(a.vertexAttribPointer(k,d.itemSize,h,v,0,0),a.enableVertexAttribArray(k));c.vbos.set(e,{handle:g,name:e,count:d.count,itemSize:d.itemSize,type:b.attributes.position.array.constructor,version:0})}a.bindBuffer(a.ARRAY_BUFFER,null);a.bindVertexArray(null);return c}updateBuffer(a,b){var c=this.buffers.get(b);a.bindVertexArray(c.vao);
for(var e in b.attributes){var d=b.attributes[e],g=X[e],k=d.normalized,v=this.types.get(d.array.constructor);if(c.vbos.has(e)){var h=c.vbos.get(e).handle;c.vbos.get(e).version=d.version}else h=a.createBuffer(),c.vbos.set(e,{handle:h,name:e,count:d.count,itemSize:d.itemSize,type:b.attributes.position.array.constructor,version:d.version});a.bindBuffer(a.ARRAY_BUFFER,h);a.bufferData(a.ARRAY_BUFFER,d.array,a.STATIC_DRAW);a.vertexAttribPointer(g,d.itemSize,v,k,0,0);a.enableVertexAttribArray(g)}a.bindBuffer(a.ARRAY_BUFFER,
null);a.bindVertexArray(null)}fetchOctrees(){for(var a=[],b=[this];0<b.length;){var c=b.pop();c instanceof R?a.push(c):(c=c.children.filter(a=>a.visible),b.push(...c))}return{octrees:a}}renderNodes(a,b,c,e,d,g){a=a.getContext();b=b.material;d=d.matrixWorldInverse;var f=new THREE.Matrix4,l=new Float32Array(16),h;for(h of c)if(void 0===w.debug.allowedNodes||w.debug.allowedNodes.includes(h.name)){var m=h.sceneNode.matrixWorld;f.multiplyMatrices(d,m);e&&(c=e.offsets.get(h),g.setUniform1f('uVNStart',c));
c=h.getLevel();g.setUniform('uDebug',!0===h.debug);if(h instanceof aa)var n=0===Object.keys(h.children).length;else h instanceof fa&&(n=h.geometryNode.isLeaf);g.setUniform('uIsLeafNode',n);var q=g.uniformLocations.modelMatrix;q&&(l.set(m.elements),a.uniformMatrix4fv(q,!1,l));q=g.uniformLocations.modelViewMatrix;l.set(f.elements);a.uniformMatrix4fv(q,!1,l);if(b.clipPolygons&&0<b.clipPolygons.length){q=[];var p=[];for(t of b.clipPolygons){d=t.viewMatrix;var r=t.projMatrix.clone().multiply(d).multiply(m);
q.push(t.markers.length);p.push(r)}m=[].concat(...p.map(a=>a.elements));r=Array(24*b.clipPolygons.length);for(p=0;p<b.clipPolygons.length;p++){var t=b.clipPolygons[p];for(var u=0;u<t.markers.length;u++)r[24*p+3*u]=t.markers[u].position.x,r[24*p+(3*u+1)]=t.markers[u].position.y,r[24*p+(3*u+2)]=t.markers[u].position.z}a.uniform1iv(g.uniformLocations['uClipPolygonVCount[0]'],q);a.uniformMatrix4fv(g.uniformLocations['uClipPolygonWVP[0]'],!1,m);a.uniform3fv(g.uniformLocations['uClipPolygonVertices[0]'],
r)}g.setUniform1f('uLevel',c);g.setUniform1f('uNodeSpacing',h.geometryNode.estimatedSpacing);g.setUniform1f('uPCIndex',p);c=h.geometryNode.geometry;m=null;if(this.buffers.has(c)){m=this.buffers.get(c);for(var x in c.attributes)c.attributes[x].version>m.vbos.get(x).version&&this.updateBuffer(a,c)}else m=this.createBuffer(a,c),this.buffers.set(c,m);a.bindVertexArray(m.vao);a.drawArrays(a.POINTS,0,m.numElements)}a.bindVertexArray(null)}renderOctree(a,b,c,e){var d=a.getContext(),f=b.material,g=e.matrixWorldInverse,
t=e.matrixWorld,h=e.projectionMatrix,m=(new THREE.Matrix4).getInverse(h);new THREE.Matrix4;var n=null,q=0;if(f.pointSizeType===P.ADAPTIVE||f.pointColorType===B.LOD){n=b.computeVisibilityTextureData(c,e);var p=f.visibleNodesTexture;p.image.data.set(n.data);p.needsUpdate=!0}p=null;this.shaders.has(f)?p=this.shaders.get(f):(p=new Ea(d,'pointcloud',f.vertexShader,f.fragmentShader),this.shaders.set(f,p));var r=['#define num_shadowmaps0','#define num_snapshots'+(f.snapEnabled?f.numSnapshots:0),'#define num_clipboxes'+
(f.clipBoxes&&f.clipBoxes.length?f.clipBoxes.length:0),'#define num_clipspheres0','#define num_clippolygons'+(f.clipPolygons&&f.clipPolygons.length?f.clipPolygons.length:0)].join('\n');p.update(r+'\n'+f.vertexShader,r+'\n'+f.fragmentShader);f.needsUpdate=!1;for(var u of Object.keys(f.uniforms))if(r=f.uniforms[u],'t'==r.type&&(r=r.value)){if(!this.textures.has(r)){var w=new ia(d,r);this.textures.set(r,w)}this.textures.get(r).update()}d.useProgram(p.program);1>f.opacity?(d.enable(d.BLEND),d.blendFunc(d.SRC_ALPHA,
d.ONE),d.depthMask(!1),d.disable(d.DEPTH_TEST)):(d.disable(d.BLEND),d.depthMask(!0),d.enable(d.DEPTH_TEST));p.setUniformMatrix4('projectionMatrix',h);p.setUniformMatrix4('viewMatrix',g);p.setUniformMatrix4('uViewInv',t);p.setUniformMatrix4('uProjInv',m);r=f.screenHeight;p.setUniform1f('uScreenWidth',f.screenWidth);p.setUniform1f('uScreenHeight',r);p.setUniform1f('fov',Math.PI*e.fov/180);p.setUniform1f('near',e.near);p.setUniform1f('far',e.far);a.capabilities.logarithmicDepthBuffer&&p.setUniform('logDepthBufFC',
2/(Math.log(e.far+1)/Math.LN2));e instanceof THREE.OrthographicCamera?(p.setUniform('uUseOrthographicCamera',!0),p.setUniform('uOrthoWidth',e.right-e.left),p.setUniform('uOrthoHeight',e.top-e.bottom)):p.setUniform('uUseOrthographicCamera',!1);0===f.clipBoxes.length+f.clipPolygons.length?p.setUniform1i('clipTask',S.NONE):p.setUniform1i('clipTask',f.clipTask);p.setUniform1i('clipMethod',f.clipMethod);f.clipBoxes&&0<f.clipBoxes.length&&d.uniformMatrix4fv(p.uniformLocations['clipBoxes[0]'],!1,f.uniforms.clipBoxes.value);
p.setUniform1f('size',f.size);p.setUniform1f('maxSize',f.uniforms.maxSize.value);p.setUniform1f('minSize',f.uniforms.minSize.value);p.setUniform1f('uOctreeSpacing',f.spacing);p.setUniform('uOctreeSize',f.uniforms.octreeSize.value);p.setUniform3f('uColor',f.color.toArray());p.setUniform1f('uOpacity',f.opacity);p.setUniform2f('elevationRange',f.elevationRange);p.setUniform2f('intensityRange',f.intensityRange);p.setUniform1f('intensityGamma',f.intensityGamma);p.setUniform1f('intensityContrast',f.intensityContrast);
p.setUniform1f('intensityBrightness',f.intensityBrightness);p.setUniform1f('rgbGamma',f.rgbGamma);p.setUniform1f('rgbContrast',f.rgbContrast);p.setUniform1f('rgbBrightness',f.rgbBrightness);p.setUniform1f('uTransition',f.transition);p.setUniform1f('wRGB',f.weightRGB);p.setUniform1f('wIntensity',f.weightIntensity);p.setUniform1f('wElevation',f.weightElevation);p.setUniform1f('wClassification',f.weightClassification);p.setUniform1f('wReturnNumber',f.weightReturnNumber);p.setUniform1f('wSourceID',f.weightSourceID);
r=this.textures.get(f.visibleNodesTexture);p.setUniform1i('visibleNodesTexture',q);d.activeTexture(d.TEXTURE0+q);d.bindTexture(r.target,r.id);q++;r=this.textures.get(f.gradientTexture);p.setUniform1i('gradient',q);d.activeTexture(d.TEXTURE0+q);d.bindTexture(r.target,r.id);q++;r=this.textures.get(f.classificationTexture);p.setUniform1i('classificationLUT',q);d.activeTexture(d.TEXTURE0+q);d.bindTexture(r.target,r.id);q++;if(!0===f.snapEnabled){r=p.uniformLocations['uSnapshot[0]'];h=p.uniformLocations['uSnapshotDepth[0]'];
g=Array(5).fill(q).map((a,b)=>a+b);t=Array(5).fill(1+Math.max(...g)).map((a,b)=>a+b);q=1+Math.max(...t);d.uniform1iv(r,g);d.uniform1iv(h,t);for(q=0;5>q;q++){r=f.uniforms.uSnapshot.value[q];h=f.uniforms.uSnapshotDepth.value[q];if(!r)break;r=a.properties.get(r).__webglTexture;h=a.properties.get(h).__webglTexture;m=t[q];d.activeTexture(d[`TEXTURE${g[q]}`]);d.bindTexture(d.TEXTURE_2D,r);d.activeTexture(d[`TEXTURE${m}`]);d.bindTexture(d.TEXTURE_2D,h)}q=[].concat(...f.uniforms.uSnapView.value.map(a=>a.elements));
d.uniformMatrix4fv(p.uniformLocations['uSnapView[0]'],!1,q);q=[].concat(...f.uniforms.uSnapProj.value.map(a=>a.elements));d.uniformMatrix4fv(p.uniformLocations['uSnapProj[0]'],!1,q);q=[].concat(...f.uniforms.uSnapProjInv.value.map(a=>a.elements));d.uniformMatrix4fv(p.uniformLocations['uSnapProjInv[0]'],!1,q);q=[].concat(...f.uniforms.uSnapViewInv.value.map(a=>a.elements));d.uniformMatrix4fv(p.uniformLocations['uSnapViewInv[0]'],!1,q)}this.renderNodes(a,b,c,n,e,p);d.activeTexture(d.TEXTURE2);d.bindTexture(d.TEXTURE_2D,
null);d.activeTexture(d.TEXTURE0)}}e.AttributeLocations=X;e.BasicGroup=Ga;e.BinaryHeap=da;e.BinaryLoader=ta;e.Classification=Ca;e.ClipMethod={INSIDE_ANY:0,INSIDE_ALL:1};e.ClipTask=S;e.DEM=qa;e.DEMNode=ea;e.EptBinaryLoader=wa;e.EptLaszipLoader=xa;e.EptLoader=Aa;e.Global=w;e.Gradients=Ba;e.GreyhoundBinaryLoader=sa;e.GreyhoundLoader=E;e.GreyhoundUtils=H;e.Group=Pa;e.HelperUtils=L;e.LASLAZLoader=ua;e.LASLoader=Q;e.LRU=na;e.POCLoader=Y;e.PointAttribute=g;e.PointAttributeNames=u;e.PointAttributeTypes=C;
e.PointAttributes=t;e.PointCloudArena4D=Da;e.PointCloudArena4DGeometry=ha;e.PointCloudEptGeometry=ya;e.PointCloudGreyhoundGeometry=ra;e.PointCloudMaterial=M;e.PointCloudOctree=ba;e.PointCloudOctreeGeometry=va;e.PointCloudTree=R;e.PointColorType=B;e.PointShape=W;e.PointSizeType=P;e.Points=Oa;e.Shader=Ea;e.Shaders=O;e.TreeType=V;e.VersionUtils=z;e.WebGLBuffer=Fa;e.WebGLTexture=ia;e.WorkerManager=A;e.loadPointCloud=function(a,b,c){var e=function(a){void 0!==b&&(a.name=b);c({type:'pointcloud_loaded',
pointcloud:a})};if(0===a.indexOf('greyhound://'))E.load(a,function(a){void 0!==a&&e(new ba(a))});else if(0<a.indexOf('cloud.js'))Y.load(a,function(a){void 0!==a&&e(new ba(a))});else if(0<a.indexOf('ept.json'))Aa.load(a,function(a){void 0!==a&&e(new ba(a))});else if(0<a.indexOf('.vpc'))ha.load(a,function(a){void 0!==a&&e(new Da(a))});else throw Error('Potree: Failed to load point cloud from URL '+a);};e.updatePointClouds=ma;e.updateVisibility=ka;e.updateVisibilityStructures=la;Object.defineProperty(e,
'__esModule',{value:!0})});
